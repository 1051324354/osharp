/**
 *
 * @name:  表格筛选扩展
 * @author: yelog
 * @link: https://github.com/yelog/layui-soul-table
 * @license: MIT
 * @version: v1.5.15
 */
layui.define(["table","form","laydate","util","excel","laytpl"],function(n){var t=layui.jquery,c=layui.table,r=layui.form,ut=layui.laydate,b=layui.laytpl,ft=layui.util,y=layui.excel,p,h,f,v,k,w={},tt="SOUL_ROW_INDEX",u={},l="layui-hide",et=1,d=[undefined,"",null],i={},it={},e={},s={eq:"等于",ne:"≠ 不等于",gt:"> 大于",ge:"≥ 大于等于",lt:"< 小于",le:"≤ 小于等于",contain:"包含",notContain:"不包含",start:"以...开头",end:"以...结尾","null":"为空",notNull:"不为空"},a={all:"全部",yesterday:"昨天",thisWeek:"本周",lastWeek:"上周",thisMonth:"本月",thisYear:"今年"},o=["column","data","condition","editCondition","excel"],g={column:"soul-column",data:"soul-dropList",condition:"soul-condition",editCondition:"soul-edit-condition",excel:"soul-export",clearCache:"soul-clear-cache"},nt={"in":"data",condition:"condition",date:"condition"},rt={data:{mode:"condition",type:"eq",value:""},condition:{mode:"in",values:[]}},ot={destroy:function(n){function u(n){if(n){var r=n.config.id;t("#soul-filter-list"+r).remove();t("#soulCondition"+r).remove();t("#soulDropList"+r).remove();delete w[r];delete i[r];delete e[r]}}if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++)u(n[r]);else u(n)},clearFilter:function(n){(typeof n=="string"&&(n=e[n]),i[n.id]&&i[n.id].filterSos&&i[n.id].filterSos!=="[]")&&(i[n.id].filterSos="[]",this.soulReload(n,!0),e[n.id].where&&e[n.id].where.filterSos&&e[n.id].where.filterSos!=="[]"&&(e[n.id].where.filterSos="[]"))},render:function(n){for(var b=this,k=t(n.elem),ui=k.next().children(".layui-table-box").children(".layui-table-main"),et=k.next().children(".layui-table-box").children(".layui-table-header").children("table"),ct=k.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),lt=k.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),v=n.id,y=b.getCompleteCols(n.cols),ci=n.filter?n.filter.items||o:o,ni=!1,fi=!1,li=typeof n.excel=="undefined"||(n.excel&&(typeof n.excel.on=="undefined"||n.excel.on)?n.excel:!1),g,yt,ti,ei,rt,oi,ft,pt,ut,si,ii,hi,wt,ht,bt,ot,kt,st,nt,dt,gt,at,vt,ri,a=0;a<y.length;a++)y[a].field&&y[a].filter&&(ni=!0,et.find('th[data-field="'+y[a].field+'"]').children().children(".soul-table-filter").length===0&&(fi=!0,et.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").length>0?(et.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").hide(),et.find('th[data-field="'+y[a].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" lay-sort="'+et.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>')):et.find('th[data-field="'+y[a].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>'),ct.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").length>0?(ct.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").hide(),ct.find('th[data-field="'+y[a].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" lay-sort="'+ct.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>')):ct.find('th[data-field="'+y[a].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>'),lt.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").length>0?(lt.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").hide(),lt.find('th[data-field="'+y[a].field+'"]').children().append('<span class="layui-table-sort soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" lay-sort="'+lt.find('th[data-field="'+y[a].field+'"]').children().children(".layui-table-sort").attr("lay-sort")+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>')):lt.find('th[data-field="'+y[a].field+'"]').children().append('<span class="soul-table-filter layui-inline" data-items="'+(y[a].filter.items?y[a].filter.items.join(","):"")+'" data-column="'+y[a].field+'" '+(typeof y[a].filter.split=="undefined"?"":'data-split="'+y[a].filter.split+'"')+'><i class="soul-icon soul-icon-filter"><\/i><i class="soul-icon soul-icon-filter-asc"><\/i><i class="soul-icon soul-icon-filter-desc"><\/i><\/span>')));if(e[n.id]=n,it[n.id]=ni,ni){if(!(n.filter&&typeof n.filter.bottom!="undefined"&&!n.filter.bottom)&&k.next().children(".soul-bottom-contion").length===0){k.next().children(".layui-table-box").after('<div class="soul-bottom-contion"><div class="condition-items"><\/div><div class="editCondtion"><a class="layui-btn layui-btn-primary">编辑筛选条件<\/a><\/div><\/div>');yt=k.next().children(".layui-table-box").children(".layui-table-body").outerHeight()-k.next().children(".soul-bottom-contion").outerHeight();n.page&&k.next().children(".layui-table-page").hasClass("layui-hide")&&(yt+=k.next().children(".layui-table-page").outerHeight());k.next().children(".layui-table-box").children(".layui-table-body").css("height",yt);ti=yt-b.getScrollWidth(ui[0]);ei=ui.children("table").height();k.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").css("height",ei>=ti?ti:"auto");k.next().children(".soul-bottom-contion").children(".condition-items").css("width",k.next().children(".soul-bottom-contion").width()-k.next().children(".soul-bottom-contion").children(".editCondtion").width()+"px");k.next().children(".soul-bottom-contion").children(".editCondtion").children("a").on("click",function(){b.showConditionBoard(n)})}if(!fi||w[n.id]||n.isSoulFrontFilter){w[n.id]=!1;n.isSoulFrontFilter=!1;!n.url&&n.page&&n.data&&n.data.forEach(function(t){u[n.id][t[tt]]=t});this.bindFilterClick(n);return}if(!n.url&&n.page&&n.data&&n.data.length>n.limit&&layui.each(n.data,function(t,i){i[n.indexName]=t}),u[n.id]=n.url&&!n.page?layui.table.cache[n.id]:n.data||layui.table.cache[n.id],u[n.id].forEach(function(n,t){n[tt]=t}),n.filter&&n.filter.clearFilter){if(n.where&&n.where.filterSos&&JSON.parse(n.where.filterSos).length>0){n.where.filterSos="[]";i[n.id]=n.where||{};b.soulReload(n,!1);return}i[n.id]=n.where||{}}else{if((typeof n.url!="undefined"&&n.page?typeof n.where.filterSos=="undefined":!0)&&i[n.id]&&JSON.parse(i[n.id].filterSos||"[]").length>0){n.where.filterSos=i[n.id].filterSos;i[n.id]=n.where;b.soulReload(n,!1);return}i[n.id]=n.where||{}}if(t("#soul-filter-list"+v).length===0){if(typeof n.soulSort=="undefined"||n.soulSort){typeof k.attr("lay-filter")=="undefined"&&k.attr("lay-filter",v);c.on("sort("+k.attr("lay-filter")+")",function(r){n.limit=e[n.id].limit;n.url&&n.page?(i[n.id].field=r.field,i[n.id].order=r.type,w[n.id]=!0,c.render(t.extend(n,{initSort:r,where:i[n.id],page:{curr:1}}))):!n.url&&n.page&&(u[n.id]=r.type==="asc"?layui.sort(u[n.id],r.field):r.type==="desc"?layui.sort(u[n.id],r.field,!0):layui.sort(u[n.id],n.indexName),n.initSort=r,n.page={curr:1},b.soulReload(n,!1))})}for(rt=[],oi={column:'<li class="soul-column"><i class="layui-icon layui-icon-table"><\/i> 表格列 <i class="layui-icon layui-icon-right" style="float: right"><\/i><\/li>',data:'<li class="soul-dropList"><i class="soul-icon soul-icon-drop-list"><\/i> 筛选数据 <i class="layui-icon layui-icon-right" style="float: right"><\/i><\/li>',condition:'<li class="soul-condition"><i class="soul-icon soul-icon-query"><\/i> 筛选条件 <i class="layui-icon layui-icon-right" style="float: right"><\/i><\/li>',editCondition:'<li class="soul-edit-condition"><i class="layui-icon layui-icon-edit"><\/i> 编辑筛选条件 <\/li>',excel:'<li class="soul-export"><i class="soul-icon soul-icon-download"><\/i> 导出excel <\/li>',clearCache:'<li class="soul-clear-cache"><i class="layui-icon layui-icon-delete"><\/i> 清除缓存 <\/li>'},rt.push('<div id="soul-filter-list'+v+'"><form action="" class="layui-form" lay-filter="orm"><ul id="main-list'+v+'" style="display: none">'),rt.push('<li class="soul-sort" data-value="asc" ><i class="soul-icon soul-icon-asc"><\/i> 升序排列 <\/li>'),rt.push('<li class="soul-sort" data-value="desc"  style="border-bottom: 1px solid #e6e6e6"><i class="soul-icon soul-icon-desc"><\/i> 降序排列 <\/li>'),a=0;a<o.length;a++)(o[a]!=="excel"||li)&&rt.push(oi[o[a]]);for(rt.push('<\/ul><ul id="soul-columns'+v+'" style="display: none;">'),ft={},a=0;a<y.length;a++){if(y[a].type==="checkbox"||!y[a].field){rt.push('<li class="layui-hide"><input type="checkbox" title="'+y[a].title+'" /><\/li>');continue}rt.push('<li data-value="'+y[a].field+'" data-key="'+a+'"><input type="checkbox" value="'+(y[a].field||a)+'" title="'+y[a].title+'" data-fixed="'+(y[a].fixed||"")+'" lay-skin="primary" lay-filter="changeColumns'+v+'" '+(y[a].hide?"":"checked")+"><\/li>");y[a].filter&&y[a].filter.type&&(y[a].filter.field?ft[y[a].filter.field]=y[a].filter.type:ft[y[a].field]=y[a].filter.type)}JSON.stringify(ft).length!==2&&(n.where.tableFilterType=JSON.stringify(ft));rt.push('<\/ul><div id="soul-dropList'+v+'" style="display: none"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"><\/div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;<\/i> 全选<\/div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;<\/i> 清空<\/div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;<\/i>反选<\/div><\/div><ul><\/ul><\/div>');rt.push('<ul id="soul-condition'+v+'" style="display: none;"><\/ul><\/form><\/div>');t("body").append(rt.join(""));pt=!0;r.on("checkbox(changeColumns"+v+")",function(i){pt=!1;i.elem.checked?(k.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th[data-field="+i.value+"]").removeClass(l),k.next().children(".layui-table-box").children(".layui-table-body").find("tbody>tr>td[data-field="+i.value+"]").removeClass(l),k.next().children(".layui-table-total").find("tbody>tr>td[data-field="+i.value+"]").removeClass(l),t(i.elem).data("fixed")&&k.next().children(".layui-table-box").children(".layui-table-fixed-"+t(i.elem).data("fixed").substr(0,1)).find("[data-field="+i.value+"]").removeClass(l)):(k.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th[data-field="+i.value+"]").addClass(l),k.next().children(".layui-table-box").children(".layui-table-body").find("tbody>tr>td[data-field="+i.value+"]").addClass(l),k.next().children(".layui-table-total").find("tbody>tr>td[data-field="+i.value+"]").addClass(l),t(i.elem).data("fixed")&&k.next().children(".layui-table-box").children(".layui-table-fixed-"+t(i.elem).data("fixed").substr(0,1)).find("[data-field="+i.value+"]").addClass(l));var r=[].concat.apply([],n.cols);for(a=0;a<r.length;a++)r[a].field&&r[a].field===i.value&&(r[a].hide=!i.elem.checked);layui.soulTable&&layui.soulTable.fixTableRemember(n);k.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr.childTr").children("td").attr("colspan",k.next().children(".layui-table-box").children(".layui-table-header").find("thead>tr>th:visible").length)});t("#soul-columns"+v+">li[data-value]").on("click",function(){t(this).find(":checkbox").is(":disabled")||(pt&&t(this).find("div.layui-form-checkbox").trigger("click"),pt=!0)});t("#soul-dropList"+v+" .check [data-type]").on("click",function(){switch(t(this).data("type")){case"all":t(this).parents("#soul-dropList"+v).find("input[type=checkbox]:not(:checked)").prop("checked",!0);break;case"reverse":t(this).parents("#soul-dropList"+v).find("input[type=checkbox]").each(function(){t(this).prop("checked",!t(this).prop("checked"))});break;case"none":t(this).parents("#soul-dropList"+v).find("input[type=checkbox]:checked").prop("checked",!1)}return r.render("checkbox","orm"),b.updateDropList(n,t("#main-list"+v).data("field")),!1});t("#soul-dropList"+v+" .filter-search input").on("input",function(){var n=t(this).val();n===""?t("#soul-dropList"+v+">ul>li").show():(t("#soul-dropList"+v+">ul>li").hide(),t("#soul-dropList"+v+'>ul>li[data-value*="'+n.toLowerCase()+'"]').show())});t("#main-list"+v+" .soul-column").on("mouseover",function(i){b.hideDropList(n);b.hideCondition(n);i.stopPropagation();p&&clearTimeout(p);t("#soul-columns"+v).show();var r,u;t(this).parent().offset().left+t(this).parent().width()+t("#soul-columns"+v).width()<document.body.clientWidth?(r=t(this).parent().offset().left+t(this).parent().width(),u="fadeInLeft"):(r=t(this).parent().offset().left-t("#soul-columns"+v).width(),u="fadeInRight");t("#soul-columns"+v).css({top:t(this).offset().top,left:r}).removeClass().addClass(u+" animated")});t("#main-list"+v+" .soul-dropList").on("mouseover",function(u){var s,c,e,o;if(t("#soul-dropList"+v).is(":visible")&&!t("#soul-dropList"+v).hasClass("fadeOutLeft"))return!1;b.hideColumns(n);b.hideCondition(n);u.stopPropagation();h&&clearTimeout(h);t("#soul-dropList"+v+">.filter-search>input").val("");t("#soul-dropList"+v).show();e=t("#main-list"+v).data("field");t("#main-list"+v).offset().left+t("#soul-dropList"+v).width()+t("#soul-dropList"+v).width()<document.body.clientWidth?(s=t("#main-list"+v).offset().left+t("#main-list"+v).width(),c="fadeInLeft"):(s=t("#main-list"+v).offset().left-t("#soul-dropList"+v).width(),c="fadeInRight");t("#soulDropList"+v).find("."+e+"DropList li input[type=checkbox]:checked").prop("checked",!1);var l=i[n.id]||{},f=JSON.parse(l.filterSos?l.filterSos:null),y="",p="";if(f)for(a=0;a<f.length;a++)if(f[a].head&&f[a].mode==="in"&&f[a].field===e){for(y=f[a].id,p=f[a].prefix,g=0;g<f[a].values.length;g++)t("#soulDropList"+v).find("."+e+'DropList li input[type=checkbox][value="'+f[a].values[g]+'"]').prop("checked",!0);break}t("#soul-dropList"+v+">ul").data({head:!0,id:y,prefix:p,refresh:!0,split:t("#main-list"+v).data("split")}).html(t("#soulDropList"+v).find("."+e+"DropList li").clone());t("#soul-dropList"+v).css({top:t(this).offset().top,left:s}).show().removeClass().addClass(c+" animated");setTimeout(function(){t("#soul-dropList"+v+">.filter-search>input").focus();r.render("checkbox","orm")},1);o=!0;r.on("checkbox(soulDropList"+v+")",function(){o=!1;b.updateDropList(n,e)});t("#soul-dropList"+v+">ul>li[data-value]").on("click",function(){o&&t(this).find("div.layui-form-checkbox").trigger("click");o=!0})});t("#main-list"+v+" .soul-condition").on("mouseover",function(u){var nt,g,k,o,it,p,w,l;if(t("#soul-condition"+v).is(":visible")&&!t("#soul-condition"+v).hasClass("fadeOutLeft"))return!1;b.hideColumns(n);b.hideDropList(n);u.stopPropagation();f&&clearTimeout(f);nt=document.body.clientWidth;t("#soul-condition"+v).show();o=t(this).parent().data("field");t(this).parent().offset().left+t(this).parent().width()+t("#soul-condition"+v).width()<nt?(g=t(this).parent().offset().left+t(this).parent().width(),k="fadeInLeft"):(g=t(this).parent().offset().left-t("#soul-condition"+v).width(),k="fadeInRight");var e,h=[],tt=i[n.id]||{},c=JSON.parse(tt.filterSos?tt.filterSos:null);if(c)for(a=0;a<c.length;a++)if(c[a].head&&c[a].field===o&&(c[a].mode==="date"||c[a].mode==="group")){e=c[a];break}if(it=t(this).parent().data("type"),b.startsWith(it,"date"))b.showDate(n,o,e,k,t(this).offset().top,t(this).parent().offset().left+t(this).parent().width(),"down",!0);else{for(p={},a=0;a<y.length;a++)y[a].field&&(p[y[a].field]=y[a]);w="<select lay-filter='conditionChange'>";for(l in s)w+='<option value="'+l+'">'+s[l]+"<\/option>";if(w+="<\/select>",h.push('<table class="condition-table"><tbody>'),e&&e.children&&e.children.length>0)for(a=0;a<e.children.length;a++){var ft=e.children[a].id,rt=e.children[a].prefix,et=e.children[a].type,ot=e.children[a].value;h.push('<tr data-id="'+ft+'">');a===0?h.push('<td class="soul-condition-title">'+p[o].title+"<\/td>"):h.push('<td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" '+(!rt||rt==="and"?"checked":"")+">    <\/div><\/td>");h.push('<td style="width: 110px;"><div class="layui-block" ><select lay-filter="conditionChange">');for(l in s)h.push('<option value="'+l+'" '+(l===et?"selected":"")+">"+s[l]+"<\/option>");h.push("<\/select><\/div><\/td>");h.push('<td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" value="'+(ot||"")+'" placeholder="值" /><\/div><\/td>');h.push('<td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"><\/i><\/td>');h.push("<\/tr>")}else h.push('<tr data-id="" data-type="eq" data-value=""><td class="soul-condition-title">'+p[o].title+'<\/td><td style="width: 110px;"><div class="layui-block" >'+w+'<\/div><\/td><td style="width: 110px;"><div class="layui-block" ><input class="layui-input value" placeholder="值" /><\/div><\/td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"><\/i><\/td><\/tr>');h.push('<\/tbody><\/table><div style="text-align: center; padding-top: 5px"><button class="layui-btn layui-btn-sm" data-type="add"><i class="layui-icon">&#xe654;<\/i>添加<\/button><span style="display: inline-block;width: 50px"><\/span><button class="layui-btn layui-btn-sm" data-type="search"><i class="layui-icon">&#xe615;<\/i>查询<\/button><\/div>');t("#soul-condition"+v).data({head:!0,id:e?e.id||"":""}).html(h.join("")).css({top:t(this).offset().top,left:g}).show().removeClass().addClass(k+" animated");t(".condition-table").on("click",function(){return!1});t("#soul-condition"+v+" button[data-type]").on("click",function(){var h,c;if(t(this).data("type")==="add"){var u=t("#soul-condition"+v).data("id"),f=t("#soul-condition"+v).data("head"),s="eq",i,e=t("#soul-condition"+v).find("tr:eq(0)");i=u?{head:f,prefix:"and",field:o,mode:"condition",type:s,value:"",groupId:u}:{head:f,prefix:f?"and":"and",mode:"group",field:o,children:[{id:b.getDifId(),prefix:"and",field:o,mode:"condition",type:e.find("select").val(),value:e.find(".value").val()},{id:b.getDifId(),prefix:"and",field:o,mode:"condition",type:s,value:""}]};b.updateWhere(n,i);u||(t("#soul-condition"+v).data("id",i.id),e.data("id",i.children[0].id));h=u?i.id:i.children[1].id;c='<tr data-id="'+h+'"><td>   <div>      <input type="checkbox" name="switch" lay-filter="soul-coondition-switch" lay-skin="switch" lay-text="与|或" checked>   <\/div><\/td><td style="width: 110px;"><div class="layui-block">'+w+'<\/div><\/td><td style="width: 110px;"><div class="layui-block"><input class="layui-input value" placeholder="值" /><\/div><\/td><td><i class="layui-icon layui-icon-delete del" style="font-size: 23px; color: #FF5722; cursor: pointer"><\/i><\/td><\/tr>';t("#soul-condition"+v+">table>tbody").append(c);t("#soul-condition"+v).find(".del:last").on("click",function(){ut(this)});t("#soul-condition"+v+" input.value:last").on("input",function(){d(t(this).parents("tr:eq(0)"))})}else t(this).data("type")==="search"&&b.soulReload(n);return r.render("select","orm"),r.render("checkbox","orm"),!1});t("#soul-condition"+v+" input.value").on("input",function(){d(t(this).parents("tr:eq(0)"))});function d(i){var u=i.data("id"),r=t("#soul-condition"+v).data("id"),f=i.find('input[lay-filter="soul-coondition-switch"]:checked').prop("checked")?"and":"or",s=i.find("select").val(),h=i.find(".value").val(),c=t("#soul-condition"+v).data("head");e=r?{id:u,prefix:f,mode:"condition",field:o,type:s,value:h,groupId:r}:{head:c,prefix:c?"and":"and",mode:"group",field:o,children:[{id:b.getDifId(),prefix:f,mode:"condition",field:o,type:s,value:h,groupId:r}]};b.updateWhere(n,e);r?u||i.data("id",e.id):(t("#soul-condition"+v).data("id",e.id),i.data("id",e.children[0].id))}r.on("select(conditionChange)",function(n){n.value==="null"||n.value==="notNull"?t(this).parents("tr").find("input.value").hide():t(this).parents("tr").find("input.value").show();d(t(n.elem).parents("tr:eq(0)"))});r.on("switch(soul-coondition-switch)",function(){d(t(this).parents("tr:eq(0)"))});t("#soul-condition"+v+" .del").on("click",function(){ut(this)});function ut(i){var u;t(i).parents("table:eq(0)").find("tr").length===1?(u=t("#soul-condition"+v).data("id"),t("#soul-condition"+v).data("id",""),t(i).parents("tr:eq(0)").find("select").val("eq"),t(i).parents("tr:eq(0)").find(".value").val("").show(),r.render("select","orm")):(u=t(i).parents("tr:eq(0)").data("id"),t(i).parents("tr:eq(0)").index()===0&&t(i).parents("table:eq(0)").find("tr:eq(1)>td:eq(0)").html(p[o].title).addClass("soul-condition-title"),t(i).parents("tr:eq(0)").remove());u&&b.updateWhere(n,{id:u,"delete":!0})}}r.render("select","orm");r.render("checkbox","orm")});t("#soul-columns"+v+", #soul-dropList"+v).on("mouseover",function(n){n.stopPropagation()});t("#main-list"+v+" .soul-edit-condition").on("mouseover",function(t){b.hideColumns(n);b.hideDropList(n);b.hideCondition(n);t.stopPropagation()}).on("click",function(){t("#main-list"+v).hide();b.showConditionBoard(n)});t("#main-list"+v+" .soul-export").on("mouseover",function(t){b.hideColumns(n);b.hideDropList(n);b.hideCondition(n);t.stopPropagation()}).on("click",function(){t("#main-list"+v).hide();b.export(e[n.id])});t("#main-list"+v+" .soul-clear-cache").on("mouseover",function(t){b.hideColumns(n);b.hideDropList(n);b.hideCondition(n);t.stopPropagation()}).on("click",function(){t("#main-list"+v).hide();layui.soulTable&&layui.soulTable.clearCache(n);layer.msg("已还原！",{icon:1,time:1e3})});t("#main-list"+v).on("mouseover",function(i){var u=i.pageX,f=i.pageY,r=t(this),e=r.offset().top,s=e+r.height(),o=r.offset().left,h=o+r.width();u<=o||u>=h||f<=e||f>=s||(b.hideColumns(n),b.hideDropList(n),b.hideCondition(n))})}else{for(ft={},a=0;a<y.length;a++)y[a].type!=="checkbox"&&y[a].field&&y[a].filter&&y[a].filter.type&&(y[a].filter.field?ft[y[a].filter.field]=y[a].filter.type:ft[y[a].field]=y[a].filter.type);JSON.stringify(ft).length!==2&&(n.where.tableFilterType=JSON.stringify(ft))}if(t("#soulDropList"+v).length===0&&t("body").append('<div id="soulDropList'+v+'" style="display: none"><\/div>'),et.find(".soul-table-filter").length>0)if(ut=[],si=ci.indexOf("data")!==-1,et.find(".soul-table-filter").each(function(){t(this).data("column")&&(si?!t(this).data("items")||t(this).data("items").split(",").indexOf("data")!==-1:t(this).data("items").split(",").indexOf("data")!==-1)&&ut.push(t(this).data("column"))}),ut.length>0)if(typeof n.url!="undefined"&&n.page)ii=JSON.parse(JSON.stringify(n.where)),hi=n.url,ii.columns=JSON.stringify(ut),t.ajax({url:hi,data:ii,dataType:"json",method:"post",headers:n.headers||{},contentType:n.contentType,success:function(n){var h=[],r,i,f,u,o,s,e,c;for(r in n)if(i=n[r],i.length===1&&i[0]===""||i.length===0)h.push("<ul class='"+r+"DropList' data-value='"+r+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)<\/li><\/ul>");else{for(f=[],f.push("<ul class='"+r+"DropList' data-value='"+r+"'>"),u=y,g=0;g<u.length;g++)if(u[g].field===r){if(u[g].filter.split){for(o=[],a=0;a<i.length;a++)for(s=i[a].split(u[g].filter.split),e=0;e<s.length;e++)o.indexOf(s[e])===-1&&o.push(s[e]);i=o}for(i.sort(function(n,t){return isNaN(n)||isNaN(t)?String(n)>=String(t):Number(n)-Number(t)}),a=0;a<i.length;a++)d.indexOf(i[a])===-1&&(c={},c[r]=i[a],f.push('<li data-value="'+String(i[a]).toLowerCase()+'"><input type="checkbox" value="'+i[a]+'" title="'+b.parseTempData(u[g],i[a],c,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+v+'"><\/li>'));break}f.push("<\/ul>");h.push(f.join(""))}t("#soulDropList"+v).html(h.join(""))},error:function(){}});else{for(wt=u[n.id],ht={},a=0;a<wt.length;a++)for(g=0;g<ut.length;g++)bt=typeof wt[a][ut[g]]=="undefined"?"":wt[a][ut[g]],ht[ut[g]]?ht[ut[g]].indexOf(bt)===-1&&ht[ut[g]].push(bt):ht[ut[g]]=[bt];for(ot=y,kt=[],g=0;g<ot.length;g++)if(st=ot[g].field,nt=ht[st],!nt||nt.length===1&&nt[0]==="")kt.push("<ul class='"+st+"DropList' data-value='"+st+"'><li style='color: gray;line-height: 25px;padding-left: 20px;'>(无数据)<\/li><\/ul>");else{if(ot[g].filter&&ot[g].filter.split){for(dt=[],a=0;a<nt.length;a++)for(gt=String(nt[a]).split(ot[g].filter.split),at=0;at<gt.length;at++)dt.indexOf(gt[at])===-1&&dt.push(gt[at]);nt=dt}for(nt.sort(function(n,t){return isNaN(n)||isNaN(t)?String(n)>=String(t):Number(n)-Number(t)}),vt=[],vt.push("<ul class='"+st+"DropList' data-value='"+st+"'>"),a=0;a<nt.length;a++)d.indexOf(nt[a])===-1&&(ri={},ri[st]=nt[a],vt.push('<li data-value="'+String(nt[a]).toLowerCase()+'"><input type="checkbox" value="'+nt[a]+'" title="'+b.parseTempData(ot[g],nt[a],ri,!0).replace(/\"|\'/g,"'")+'" lay-skin="primary" lay-filter="soulDropList'+v+'"><\/li>'));vt.push("<\/ul>");kt.push(vt.join(""))}t("#soulDropList"+v).html(kt.join(""))}else b.bindFilterClick(n);this.bindFilterClick(n)}},showConditionBoard:function(n){function g(n,t,i,r,u){var c=n.id,e=n.field,h=n.mode,o=n.type,l=n.prefix==="or",f;t.push('<li data-id="'+c+'" data-field="'+e+'" '+(u?'class="last"':"")+' data-mode="'+h+'" data-type="'+o+'" data-value="'+(typeof n.value=="undefined"?"":n.value)+'" >');t.push('<div><table><tbody><tr><td data-type="top"><\/td><\/tr><tr><td data-type="bottom"><\/td><\/tr><\/tbody><\/table><\/div>');t.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" '+(l?"":"checked")+"><\/div>");switch(h){case"in":t.push('<div class="layui-firebrick item-field">'+i[e].title+"<\/div>");t.push('<div class="layui-deeppink item-type" >筛选数据<\/div>');t.push('<div class="layui-blueviolet item-value">共'+(n.values?n.values.length:0)+"条数据<\/div>");t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>');break;case"date":t.push('<div class="layui-firebrick item-field">'+i[e].title+"<\/div>");t.push('<div class="layui-deeppink item-type">选择日期<\/div>');t.push('<div class="layui-blueviolet item-value">'+(n.type==="specific"?n.value||"请选择":a[n.type])+"<\/div>");t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>');break;case"condition":t.push('<div class="layui-firebrick item-field">'+i[e].title+"<\/div>");t.push('<div class="layui-deeppink item-type">'+s[n.type]+"<\/div>");o!=="null"&&o!=="notNull"&&t.push('<div class="layui-blueviolet item-value">'+(typeof n.value=="undefined"||n.value===""?"请输入...":n.value)+"<\/div>");t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>');break;case"group":if(t.push('<div class="layui-firebrick">分组<\/div>'),t.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"><\/i> 添加条件<\/a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"><\/i> 添加分组<\/a><\/div>'),t.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>'),t.push('<ul class="group '+(u?"":"line")+'">'),n.children)for(f=0;f<n.children.length;f++)g(n.children[f],t,i,f===0,f===n.children.length-1);t.push("<\/ul>")}t.push("<\/li>")}function ft(i){var r=i.elem.checked?"and":"or",f=t(i.elem).parents("li:eq(0)").data("id"),e=t(".soul-edit-out .out_auto").prop("checked");t(i.elem).parents("li:eq(0)").data("prefix",r);u.updateWhere(n,{id:f,prefix:r});e&&u.soulReload(n)}function nt(i){u.hideDropList(n);u.hideCondition(n);u.hideColumns(n);u.hideBfPrefix(n);u.hideBfType(n);var r=t(i).offset().top+t(i).outerHeight(),f=t(i).offset().left;t("#soul-bf-column"+c).find("li.soul-bf-selected").removeClass("soul-bf-selected");t("#soul-bf-column"+c).data("field",t(i).parent().data("field")).data("id",t(i).parent().data("id")).data("mode",t(i).parent().data("mode")).data("group",t(i).parents("li:eq(2)").data("id")||"").data("refresh",t(".soul-edit-out .out_auto").prop("checked")).show().css({top:r,left:f}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+t(i).parent().data("field")+'"]').addClass("soul-bf-selected")}function tt(i){u.hideDropList(n);u.hideCondition(n);u.hideColumns(n);u.hideBfColumn(n);u.hideBfPrefix(n);var f=t(i).offset().top+t(i).outerHeight(),e=t(i).offset().left,r=t(i).parent().data("field");t("#soul-bf-type"+c+" li").hide();k[r]&&k[r].indexOf("date")===0&&t("#soul-bf-type"+c+" li[data-mode=date]").show();y[r].items.indexOf("data")!==-1&&t("#soul-bf-type"+c+" li[data-mode=in]").show();y[r].items.indexOf("condition")!==-1&&t("#soul-bf-type"+c+" li[data-mode=condition]").show();t("#soul-bf-type"+c).find("li.soul-bf-selected").removeClass("soul-bf-selected");switch(t(i).parent().data("mode")){case"in":t("#soul-bf-type"+c).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":t("#soul-bf-type"+c).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":t("#soul-bf-type"+c).find('li[data-value="'+t(i).parent().data("type")+'"]').addClass("soul-bf-selected")}t("#soul-bf-type"+c).data("type",t(i).parent().data("type")).data("mode",t(i).parent().data("mode")).data("id",t(i).parent().data("id")).data("group",t(i).parents("li:eq(2)").data("id")||"").data("refresh",t(".soul-edit-out .out_auto").prop("checked")).show().css({top:f,left:e}).removeClass().addClass("fadeInUp animated")}function it(e){var y,o,a;u.hideColumns(n);u.hideBfType(n);u.hideBfPrefix(n);u.hideBfColumn(n);var a,w=t(e).offset().left,g=t(e).parent().data("mode"),s=t(e).parent().data("field"),v=t(e).parent().data("id"),nt=t(e).parent().data("head"),tt=t(e).parent().data("prefix"),b=t(e).parent().data("value"),p=t(".soul-edit-out .out_auto").prop("checked"),k=i[n.id]||{},d=k.filterSos?JSON.parse(k.filterSos):[];switch(g){case"in":if(u.hideCondition(n),h&&clearTimeout(h),t("#soul-dropList"+c+">.filter-search>input").val(""),t("#soul-dropList"+c).show(),t("#soulDropList"+c).find("."+s+"DropList li input[type=checkbox]:checked").prop("checked",!1),o=u.getFilterSoById(d,v),o.values)for(l=0;l<o.values.length;l++)t("#soulDropList"+c).find("."+s+'DropList li input[type=checkbox][value="'+o.values[l]+'"]').prop("checked",!0);t("#soul-dropList"+c+">ul").data("id",v).data("head",nt).data("refresh",p).data("prefix",tt).html(t("#soulDropList"+c).find("."+s+"DropList li").clone());r.render("checkbox","orm");a=t(e).offset().top+t(e).outerHeight();t("#soul-dropList"+c).css({top:a,left:w}).show().removeClass().addClass("fadeInUp animated");setTimeout(function(){t("#soul-dropList"+c+">.filter-search>input").focus()},1);y=!0;r.on("checkbox(soulDropList"+c+")",function(){y=!1;u.updateDropList(n,s)});t("#soul-dropList"+c+">ul>li[data-value]").on("click",function(){y&&t(this).find("div.layui-form-checkbox").trigger("click");y=!0});break;case"date":u.hideDropList(n);f&&clearTimeout(f);o=u.getFilterSoById(d,v);a=t(e).offset().top+t(e).height();u.showDate(n,s,o,"fadeInUp",a,w,"down",p);break;case"condition":t(e).hide();t(e).after('<div><input class="layui-input tempValue" value="" /><\/div>');t(e).next().children().val(b).select().on("keydown",function(n){n.keyCode===13&&t(this).blur()}).on("blur",function(){var i=t(this).val();t(e).html(typeof i=="undefined"||i===""?"请输入...":i);t(e).show();t(this).parent().remove();i!==b&&(t(e).parent().data("value",i),u.updateWhere(n,{id:v,value:i}),p&&u.soulReload(n))})}}function rt(i){var o=t(".soul-edit-out .out_auto").prop("checked"),f;e=[];switch(t(i).data("type")){case"addOne":f={prefix:"and",field:b.field,mode:"condition",type:"eq",value:""};t(i).parent().parent().data("id")&&t.extend(f,{groupId:t(i).parent().parent().data("id")});u.updateWhere(n,f);e.push('<li data-id="'+f.id+'" data-field="'+f.field+'" data-mode="'+f.mode+'" data-type="'+f.type+'" data-value="'+f.value+'" data-prefix="'+f.prefix+'" class="last">');e.push('<div><table><tbody><tr><td data-type="top"><\/td><\/tr><tr><td data-type="bottom"><\/td><\/tr><\/tbody><\/table><\/div>');e.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked><\/div>');e.push('<div class="layui-firebrick item-field">'+y[f.field].title+"<\/div>");e.push('<div class="layui-deeppink item-type">等于<\/div>');e.push('<div class="layui-blueviolet item-value">请输入...<\/div>');e.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>');e.push("<\/li>");break;case"addGroup":f={prefix:"and",mode:"group",children:[]};t(i).parent().parent().data("id")&&t.extend(f,{groupId:t(i).parent().parent().data("id")});u.updateWhere(n,f);e.push('<li data-id="'+f.id+'" class="last">');e.push('<div><table><tbody><tr><td data-type="top"><\/td><\/tr><tr><td data-type="bottom"><\/td><\/tr><\/tbody><\/table><\/div>');e.push('<div><input type="checkbox" name="switch" lay-filter="soul-edit-switch" lay-skin="switch" lay-text="与|或" checked><\/div>');e.push('<div class="layui-firebrick">分组<\/div>');e.push('<div><a class="layui-btn layui-btn-xs" data-type="addOne"><i class="layui-icon layui-icon-add-1"><\/i> 添加条件<\/a><a class="layui-btn layui-btn-xs" data-type="addGroup"><i class="layui-icon layui-icon-add-circle"><\/i> 添加分组<\/a><\/div>');e.push('<div class="layui-red delete-item"><i class="layui-icon layui-icon-close-fill"><\/i><\/div>');e.push('<ul class="group">');e.push("<\/ul>");e.push("<\/li>")}if(o&&u.soulReload(n),t(i).parent().parent().children("ul").children("li").length>0&&(t(i).parent().parent().children("ul").children("li:last").removeClass("last"),t(i).parent().parent().children("ul").children("li:last").children("ul.group").length>0&&t(i).parent().parent().children("ul").children("li:last").children("ul.group").addClass("line")),t(i).parent().parent().children("ul").append(e.join("")),r.render("checkbox","soul-edit-out"),t(i).data("type")==="addGroup")t(i).parent().parent().children("ul").children("li:last").find("a[data-type]").on("click",function(){rt(this)});else{t(i).parent().parent().children("ul").children("li:last").find(".item-field").on("click",function(n){n.stopPropagation();nt(this)});t(i).parent().parent().children("ul").children("li:last").find(".item-type").on("click",function(n){n.stopPropagation();tt(this)});t(i).parent().parent().children("ul").children("li:last").find(".item-value").on("click",function(n){n.stopPropagation();it(this)})}t(i).parent().parent().children("ul").children("li:last").children(".delete-item").on("click",function(){var i=t(this).parent().data("id"),r=t(".soul-edit-out .out_auto").prop("checked");t(this).parent().remove();u.updateWhere(n,{id:i,"delete":!0});r&&u.soulReload(n)})}for(var u=this,c=n.id,p=i[n.id]||{},k=p.tableFilterType?JSON.parse(p.tableFilterType):{},w=p.filterSos?JSON.parse(p.filterSos):[],e=[],y={},b,d,ut=n.filter?n.filter.items||o:o,v=u.getCompleteCols(n.cols),l=0;l<v.length;l++)v[l].field&&v[l].filter&&(b||(b=v[l]),d=v[l].filter.items||ut,y[v[l].field]={title:v[l].title,items:d});for(e.push('<div class="soul-edit-out">'),e.push('<div class="layui-form" lay-filter="soul-edit-out">'),e.push('<div><a class="layui-btn layui-btn-sm" data-type="addOne"><i class="layui-icon layui-icon-add-1"><\/i> 添加条件<\/a><a class="layui-btn layui-btn-sm" data-type="addGroup"><i class="layui-icon layui-icon-add-circle" ><\/i> 添加分组<\/a><a class="layui-btn layui-btn-sm" data-type="search" style="float: right"><i class="layui-icon layui-icon-search"><\/i> 查询<\/a><span style="float: right"><input type="checkbox" lay-filter="out_auto" class="out_auto" title="实时更新"><\/span><\/div>'),e.push("<hr>"),e.push("<ul>"),l=0;l<w.length;l++)g(w[l],e,y,l===0,l===w.length-1);e.push("<\/ul>");e.push("<\/div>");e.push("<\/div>");layer.open({title:"编辑条件",type:1,offset:"auto",area:["480px","480px"],content:e.join("")});r.render(null,"soul-edit-out");r.on("checkbox(out_auto)",function(t){t.elem.checked&&u.soulReload(n)});r.on("switch(soul-edit-switch)",function(n){ft(n)});t(".soul-edit-out .item-field").on("click",function(n){n.stopPropagation();nt(this)});t(".soul-edit-out .item-type").on("click",function(n){n.stopPropagation();tt(this)});t(".soul-edit-out .item-value").on("click",function(n){n.stopPropagation();it(this)});t(".soul-edit-out .delete-item").on("click",function(){var i=t(this).parent().data("id"),r=t(".soul-edit-out .out_auto").prop("checked");t(this).parent().remove();u.updateWhere(n,{id:i,"delete":!0});r&&u.soulReload(n)});t(".soul-edit-out a[data-type]").on("click",function(){t(this).data("type")==="search"?u.soulReload(n):rt(this)})},hideColumns:function(n,i){var r=n.id;t("#soul-columns"+r).removeClass().addClass("fadeOutLeft animated");p&&clearTimeout(p);typeof i=="undefined"||i?p=setTimeout(function(){t("#soul-columns"+r).hide()},500):t("[id^=soul-columns]").hide()},hideDropList:function(n,i){var r=n.id;t("#soul-dropList"+r).removeClass().addClass("fadeOutLeft animated");h&&clearTimeout(h);typeof i=="undefined"||i?h=setTimeout(function(){t("#soul-dropList"+r).hide()},500):t("[id^=soul-dropList]").hide()},hideCondition:function(n,i){var r=n.id;t("#soul-condition"+r).removeClass().addClass("fadeOutLeft animated");f&&clearTimeout(f);typeof i=="undefined"||i?f=setTimeout(function(){t("#soul-condition"+r).hide()},500):t("[id^=soul-condition]").hide()},hideBfPrefix:function(n,i){var r=n.id;t("#soul-bf-prefix"+r).removeClass().addClass("fadeOutDown animated");v&&clearTimeout(v);typeof i=="undefined"||i?v=setTimeout(function(){t("#soul-bf-prefix"+r).hide()},500):t("[id=soul-bf-prefix"+r+"]").hide()},hideBfColumn:function(n,i){var r=n.id;t("#soul-bf-column"+r).removeClass().addClass("fadeOutDown animated");v&&clearTimeout(v);typeof i=="undefined"||i?v=setTimeout(function(){t("#soul-bf-column"+r).hide()},500):t("[id=soul-bf-column"+r+"]").hide()},hideBfType:function(n,i){var r=n.id;t("#soul-bf-type"+r).removeClass().addClass("fadeOutDown animated");k&&clearTimeout(k);typeof i=="undefined"||i?k=setTimeout(function(){t("#soul-bf-type"+r).hide()},500):t("[id=soul-bf-type"+r+"]").hide()},bindFilterClick:function(n){function l(i){var e=i.data("items")?i.data("items").split(","):b,f,o,h;for(s.hideColumns(n,!1),s.hideDropList(n,!1),s.hideCondition(n,!1),t("[id^=main-list]").hide(),t("#main-list"+u).data({field:i.data("column"),split:i.data("split")}),t("#soul-columns"+u+" [type=checkbox]").attr("disabled",!1),t("#soul-columns"+u+" li[data-key="+i.parents("th").data("key").split("-")[2]+"] [type=checkbox]").attr("disabled",!0),t("#main-list"+u+" > li").hide(),i.hasClass("layui-table-sort")&&t("#main-list"+u+" .soul-sort").show(),f=0;f<e.length;f++)t("#main-list"+u+" ."+g[e[f]]).show(),t("#main-list"+u+" ."+g[e[f]]).index()!==f+2&&t("#main-list"+u+'>li:eq("'+(f+2)+'")').before(t("#main-list"+u+" ."+g[e[f]]));w&&clearTimeout(w);i.offset().left+t("#main-list"+u).outerWidth()<document.body.clientWidth?(o=i.offset().left+10,h="fadeInLeft"):(o=i.offset().left-t("#main-list"+u).outerWidth(),h="fadeInRight");t("#main-list"+u).data("type",n.where.tableFilterType?JSON.parse(n.where.tableFilterType)[i.data("column")]||"":"").hide().css({top:i.offset().top+10,left:o}).show().removeClass().addClass(h+" animated");t("#main-list"+u+" .soul-sort").on("click",function(){i.siblings(".layui-table-sort").find(".layui-table-sort-"+t(this).data("value")).trigger("click");t("#main-list"+u).hide()});r.render("checkbox","orm")}var s=this,c=t(n.elem),v=c.next().children(".layui-table-box").children(".layui-table-header").children("table"),y=c.next().children(".layui-table-box").children(".layui-table-fixed-l").children(".layui-table-header").children("table"),p=c.next().children(".layui-table-box").children(".layui-table-fixed-r").children(".layui-table-header").children("table"),u=n.id,b=n.filter?n.filter.items||o:o,w,a,e,f,h;v.find(".soul-table-filter").off("click").on("click",function(n){n.stopPropagation();l(t(this))});y.find(".soul-table-filter").off("click").on("click",function(n){n.stopPropagation();l(t(this))});p.find(".soul-table-filter").off("click").on("click",function(n){n.stopPropagation();l(t(this))});t(document).on("click",function(){t("#main-list"+u).hide();s.hideColumns(n,!1);s.hideDropList(n,!1);s.hideCondition(n,!1);s.hideBfPrefix(n,!1);s.hideBfColumn(n,!1);s.hideBfType(n,!1)});t("#main-list"+u+",#soul-columns"+u+",#soul-dropList"+u+",#soul-condition"+u).on("click",function(n){t(this).find(".layui-form-selected").removeClass("layui-form-selected");n.stopPropagation()});for(s.renderBottomCondition(n),a=i[n.id]||{},e=JSON.parse(a.filterSos?a.filterSos:"[]"),f=0;f<e.length;f++)if(e[f].head){h=!1;switch(e[f].mode){case"in":e[f].values&&e[f].values.length>0&&(h=!0);break;case"date":e[f].type!=="all"&&typeof e[f].value!="undefined"&&e[f].value!==""&&(h=!0);break;case"group":e[f].children&&e[f].children.length>0&&(h=!0)}v.find('thead>tr>th[data-field="'+e[f].field+'"] .soul-table-filter').attr("soul-filter",""+h);y.find('thead>tr>th[data-field="'+e[f].field+'"] .soul-table-filter').attr("soul-filter",""+h);p.find('thead>tr>th[data-field="'+e[f].field+'"] .soul-table-filter').attr("soul-filter",""+h)}},resize:function(n){var h=this,i=t(n.elem),e=i.next().children(".layui-table-box"),u=e.children(".layui-table-main"),r,f,o,s;i.next().children(".soul-bottom-contion").length>0&&(i.next().children(".soul-bottom-contion").children(".condition-items").css("width",i.next().children(".soul-bottom-contion").width()-i.next().children(".soul-bottom-contion").children(".editCondtion").outerWidth()),r=i.next().height()-i.next().children(".soul-bottom-contion").outerHeight(),i.next().children(".layui-table-tool").length>0&&(r=r-i.next().children(".layui-table-tool").outerHeight()),i.next().children(".layui-table-total").length>0&&(r=r-i.next().children(".layui-table-total").outerHeight()),i.next().children(".layui-table-page").length>0&&(r=r-i.next().children(".layui-table-page").outerHeight()),r=r-i.next().children(".layui-table-box").children(".layui-table-header").outerHeight(),i.next().children(".layui-table-box").children(".layui-table-body").height(r),f=r-h.getScrollWidth(u[0]),o=u.children("table").height(),i.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").height(o>=f?f:"auto"),s=u.width()-u.prop("clientWidth"),e.children(".layui-table-fixed-r").css("right",s-1))},updateDropList:function(n,i){var f=this,v=t(n.elem),r=n.id,e=t("#soul-dropList"+r+">ul").data("id"),o=t("#soul-dropList"+r+">ul input[type=checkbox]:checked"),s=[],h=t("#soul-dropList"+r+">ul").data("head"),c=t("#soul-dropList"+r+">ul").data("prefix"),l=t("#soul-dropList"+r+">ul").data("refresh"),a=t("#soul-dropList"+r+">ul").data("split"),u;o.length>0&&o.each(function(){s.push(t(this).val())});u={id:e,head:h,prefix:c||"and",mode:"in",field:i,split:a,values:s};f.updateWhere(n,u);e||t("#soul-dropList"+r+">ul").data("id",u.id);t(".soul-edit-out").length>0&&t('.soul-edit-out li[data-id="'+u.id+'"]>.item-value').html("共"+(u.values?u.values.length:0)+"条数据");l&&f.soulReload(n)},getFilterSoById:function(n,t){for(var r,u,i=0;i<n.length;i++){if(n[i].id===t)return n[i];if(n[i].mode==="group")for(r=0;r<n[i].children.length;r++)if(u=this.getFilterSoById(n[i].children,t),u)return u}return null},updateWhere:function(n,r){function s(n,i){var u=!1,r;if(n.id===i.id&&(t.extend(n,i),u=!0),i.id||n.id!==i.groupId){if(n.mode==="group")for(r=0;r<n.children.length;r++){if(i.delete&&n.children[r].id===i.id)return n.children.splice(r,1),!0;if(s(n.children[r],i))return!0}}else n.children.push(t.extend(i,{id:o.getDifId()}));return u}var o=this,e=i[n.id]||{},u=JSON.parse(e.filterSos?e.filterSos:"[]"),f;if(r.id||r.groupId)for(f=0;f<u.length;f++){if(r.delete&&u[f].id===r.id){u.splice(f,1);break}if(s(u[f],r))break}else r.mode==="in"&&!(r.values&&r.values.length>0)||u.push(t.extend(r,{id:o.getDifId()}));e.filterSos=JSON.stringify(u);n.where=e;i[n.id]=e},soulReload:function(n,r){var v=this,e=t(n.elem),h=e.next().children(".layui-table-box").children(".layui-table-main").scrollLeft(),f,l,a;if(w[n.id]=typeof r=="undefined"?!0:r,typeof n.url!="undefined"&&n.page)e.data("scrollLeft",h),c.reload(n.id,{where:i[n.id]||{},page:{curr:1}});else{var o=i[n.id]||{},s=JSON.parse(o.filterSos?o.filterSos:"[]"),y=o.tableFilterType?JSON.parse(o.tableFilterType):{},p=layer.load(2);n.page||(n.limit=1e8);s.length>0?(f=[],layui.each(u[n.id],function(n,t){for(var r=!0,i=0;i<s.length;i++)r=v.handleFilterSo(s[i],t,y,r,i===0);r&&f.push(t)}),n.page?c.reload(n.id,{data:f,initSort:n.initSort,isSoulFrontFilter:!0,page:{curr:1}}):(l=n.url,e.next().off("click"),a=c.reload(n.id,{url:"",initSort:n.initSort,isSoulFrontFilter:!0,data:f}),a.config.url=l),n.data=f):(n.page?c.reload(n.id,{data:u[n.id],initSort:n.initSort,isSoulFrontFilter:!0,page:{curr:1}}):c.reload(n.id,{data:u[n.id],initSort:n.initSort,isSoulFrontFilter:!0}),n.data=u[n.id]);e.next().children(".layui-table-box").children(".layui-table-main").scrollLeft(h);layer.close(p)}},handleFilterSo:function(n,t,i,r,u){function b(){return(new Date).setHours(0,0,0,0)/1e3}function a(){var n=new Date,t=n.getDay()||7;return new Date(n.setDate(n.getDate()-t+1)).setHours(0,0,0,0)/1e3}function d(){return new Date((new Date).setDate(1)).setHours(0,0,0,0)/1e3}function g(){var n=new Date,t=n.getMonth(),i=++t,r=new Date(n.getFullYear(),i,1);return r/1e3-1}function c(n,t,i){return n.getTime()/1e3>=t&&n.getTime()/1e3<=i}function k(n){return n+="",n.length<=1&&(n="0"+n),n}var w=u?!1:n.prefix==="or",f=n.field,o=n.value,e=!0,v,y,s,p,h,l;if(n.children&&n.children.length>0){for(s=0;s<n.children.length;s++)e=this.handleFilterSo(n.children[s],t,i,e,s===0);return w?r||e:r&&e}switch(n.mode){case"in":if(n.values&&n.values.length>0)if(n.split){for(v=(t[f]+"").split(n.split),y=!1,s=0;s<v.length;s++)n.values.indexOf(v[s])!==-1&&(y=!0);e=y}else e=n.values.indexOf(t[f]+"")!==-1;else return r;break;case"condition":if(n.type!=="null"&&n.type!=="notNull"&&(typeof o=="undefined"||o===""))return r;switch(n.type){case"eq":e=isNaN(t[f])||isNaN(o)?t[f]===o:Number(t[f])===Number(o);break;case"ne":e=isNaN(t[f])||isNaN(o)?t[f]!==o:Number(t[f])!==Number(o);break;case"gt":e=isNaN(t[f])||isNaN(o)?t[f]>o:Number(t[f])>Number(o);break;case"ge":e=isNaN(t[f])||isNaN(o)?t[f]>=o:Number(t[f])>=Number(o);break;case"lt":e=isNaN(t[f])||isNaN(o)?t[f]<o:Number(t[f])<Number(o);break;case"le":e=isNaN(t[f])||isNaN(o)?t[f]<=o:Number(t[f])<=Number(o);break;case"contain":e=(t[f]+"").indexOf(o)!==-1;break;case"notContain":e=(t[f]+"").indexOf(o)===-1;break;case"start":e=(t[f]+"").indexOf(o)===0;break;case"end":p=(t[f]+"").length-(o+"").length;e=p>=0&&(t[f]+"").lastIndexOf(o)===p;break;case"null":e=typeof t[f]=="undefined"||t[f]===""||t[f]===null;break;case"notNull":e=typeof t[f]!="undefined"&&t[f]!==""&&t[f]!==null}break;case"date":h=new Date(Date.parse(t[f].replace(/-/g,"/")));switch(n.type){case"all":e=!0;break;case"yesterday":e=t[f]&&c(h,b()-86400,b()-1);break;case"thisWeek":e=t[f]&&c(h,a(),a()+604800-1);break;case"lastWeek":e=t[f]&&c(h,a()-604800,a()-1);break;case"thisMonth":e=t[f]&&c(h,d(),g());break;case"thisYear":e=t[f]&&c(h,new Date((new Date).getFullYear(),1,1)/1e3,new Date((new Date).getFullYear()+1,1,1)/1e3-1);break;case"specific":l=h.getFullYear();l+="-"+k(h.getMonth()+1);l+="-"+k(h.getDate());e=t[f]&&l===o}}return w?r||e:r&&e},getDifId:function(){return et++},showDate:function(n,i,u,f,e,o,s,h){var v=this,c=n.id,l=[],w=document.body.clientWidth,f,p,y;l.push('<div class="'+i+'Condition" data-value="'+i+'" style="padding: 5px;" >');l.push('<div class="layui-row">');for(p in a)l.push('<div class="layui-col-sm4"><input type="radio" name="datetime'+c+i+'" lay-filter="datetime'+c+'" value="'+p+'" title="'+a[p]+'"><\/div>');l.push("<\/div>");l.push('<div><input type="radio" name="datetime'+c+i+'" lay-filter="datetime'+c+'"  value="specific" title="过滤具体日期"> <input type="hidden" class="specific_value"><div class="staticDate"><\/div><\/div><\/div>');t("#soul-condition"+c).html(l.join(""));y=ft.toDateString(new Date,"yyyy-MM-dd");u?(t("#soul-condition"+c).data({id:u.id,head:!0}),t("#soul-condition"+c+">."+i+'Condition [name^=datetime][value="'+u.type+'"]').prop("checked",!0),u.type==="specific"&&(y=u.value)):(t("#soul-condition"+c).data({id:"",head:!0}),t("#soul-condition"+c+">."+i+'Condition [name^=datetime][value="all"]').prop("checked",!0));t("#soul-condition"+c+" .specific_value").val(y);ut.render({elem:"#soul-condition"+c+" .staticDate",position:"static",calendar:!0,btns:["now"],value:y,done:function(u){var e=t("#soul-condition"+c).data("id"),o=t("#soul-condition"+c).data("head"),f;t("#soul-condition"+c+" .specific_value").val(u);t("#soul-condition"+c+" [name^=datetime]:checked").prop("checked",!1);t("#soul-condition"+c+" [name^=datetime][value=specific]").prop("checked",!0);f={id:e,head:o,prefix:o?"and":"and",mode:"date",field:i,type:"specific",value:u};v.updateWhere(n,f);e||t("#soul-condition"+c).data("id",f.id);t(".soul-edit-out").length>0&&t('.soul-edit-out li[data-id="'+f.id+'"]').children(".item-value").html(f.value);h&&v.soulReload(n);r.render("radio","orm")}});r.on("radio(datetime"+c+")",function(r){var f=t("#soul-condition"+c).data("id"),e=t("#soul-condition"+c).data("head"),u={id:f,head:e,prefix:e?"and":"and",mode:"date",field:i,type:r.value,value:t("#soul-condition"+c+" .specific_value").val()};v.updateWhere(n,u);f||t("#soul-condition"+c).data("id",u.id);t(".soul-edit-out").length>0&&t('.soul-edit-out li[data-id="'+u.id+'"]').children(".item-value").html(a[u.type]||u.value);h&&v.soulReload(n)});r.render("radio","orm");s==="down"?o+t("#soul-condition"+c).width()<w?f="fadeInLeft":(o=o-t("#main-list"+c).width()-t("#soul-condition"+c).width(),f="fadeInRight"):e=e-t("#soul-condition"+c).outerHeight()-10;t("#soul-condition"+c).css({top:e,left:o}).show().removeClass().addClass(f+" animated")},bottomConditionHtml:function(n,t,i,r){var o=this,f=t.prefix==="or",e=t.field,u;if(t.mode==="group"){if(t.children&&t.children.length>0){for(n.push('<div class="condition-item" data-id="'+t.id+'" data-prefix="'+(t.prefix||"and")+'">'),r||n.push('<div class="item-prefix layui-red">'+(f?"或":"与")+"<\/div> "),u=0;u<t.children.length;u++)o.bottomConditionHtml(n,t.children[u],i,u===0);n.push('<i class="condition-item-close soul-icon soul-icon-unfold" ><\/i>');n.push("<\/div>")}return}n.push('<div class="condition-item" data-field="'+e+'" data-id="'+t.id+'" data-mode="'+t.mode+'" data-type="'+t.type+'" data-value="'+(typeof t.value=="undefined"?"":t.value)+'" data-prefix="'+(t.prefix||"and")+'">');r||n.push('<div class="item-prefix layui-red">'+(f?"或":"与")+"<\/div> ");n.push('<div class="item-field layui-firebrick">'+i[e].title+"<\/div> ");n.push('<div class="item-type layui-deeppink">');switch(t.mode){case"in":n.push("筛选数据");break;case"condition":n.push(s[t.type]);break;case"date":n.push("选择日期");break;default:n.push("未知")}if(n.push("<\/div> "),t.type!=="null"&&t.type!=="notNull"){n.push('<div class="item-value layui-blueviolet '+(t.mode==="date"&&t.type!=="specific")+'">');switch(t.mode){case"in":n.push("共"+(t.values?t.values.length:0)+"条数据");break;case"date":n.push(t.type==="specific"?t.value||"请选择":a[t.type]);break;case"condition":default:n.push(typeof t.value=="undefined"||t.value===""?"请输入...":t.value)}n.push("<\/div>")}n.push('<i class="condition-item-close soul-icon soul-icon-unfold" ><\/i>');n.push("<\/div>")},renderBottomCondition:function(n){for(var g,tt,u=this,b=i[n.id]||{},k=b.filterSos?JSON.parse(b.filterSos):[],w=b.tableFilterType?JSON.parse(b.tableFilterType):{},it=t(n.elem),e=n.id,y=it.next().children(".soul-bottom-contion"),v={},c=[],d,ut=n.filter?n.filter.items||o:o,p=u.getCompleteCols(n.cols),l=0;l<p.length;l++)p[l].field&&p[l].filter&&(d=p[l].filter.items||ut,(d.indexOf("data")!==-1||d.indexOf("condition")!==-1)&&(v[p[l].field]={title:p[l].title,items:d}));for(l=0;l<k.length;l++)u.bottomConditionHtml(c,k[l],v,l===0);if(y.children(".condition-items").html(c.join("")),c=[],t("#soul-bf-prefix"+e).length===0&&(c.push('<div id="soul-bf-prefix'+e+'" style="display: none;"><ul>'),c.push('<li data-value="and">与<\/li>'),c.push('<li data-value="or">或<\/li>'),c.push("<\/ul><\/div>")),t("#soul-bf-column"+e).length===0){c.push('<div id="soul-bf-column'+e+'" style="display: none;"><ul>');for(g in v)c.push('<li data-field="'+g+'">'+v[g].title+"<\/li>");c.push("<\/ul><\/div>")}if(t("#soul-bf-type"+e).length===0){c.push('<div id="soul-bf-type'+e+'" style="display: none;"><ul>');c.push('<li data-value="in" data-mode="in">筛选数据<\/li>');c.push('<li data-value="all" data-mode="date">选择日期<\/li>');for(tt in s)c.push('<li data-value="'+tt+'" data-mode="condition">'+s[tt]+"<\/li>");c.push("<\/ul><\/div>")}t("#soul-bf-cond2-dropList"+e).length===0&&c.push('<div id="soul-bf-cond2-dropList'+e+'" style="display: none;"><div class="filter-search"><input type="text" placeholder="关键字搜索" class="layui-input"><\/div><div class="check"><div class="multiOption" data-type="all"><i class="soul-icon">&#xe623;<\/i> 全选<\/div><div class="multiOption" data-type="none"><i class="soul-icon">&#xe63e;<\/i> 清空<\/div><div class="multiOption" data-type="reverse"><i class="soul-icon">&#xe614;<\/i>反选<\/div><\/div><ul><\/ul><\/div>');t("body").append(c.join(""));y.find(".item-prefix").off("click").on("click",function(i){i.stopPropagation();t("#main-list"+e).hide();u.hideDropList(n);u.hideCondition(n);u.hideColumns(n);u.hideBfColumn(n);u.hideBfType(n);var r=t(this).offset().top-t("#soul-bf-prefix"+e).outerHeight()-10,f=t(this).offset().left;t("#soul-bf-prefix"+e).find("li.soul-bf-selected").removeClass("soul-bf-selected");t("#soul-bf-prefix"+e).data("id",t(this).parent().data("id")).data("prefix",t(this).parent().data("prefix")).data("refresh",!0).show().css({top:r,left:f}).removeClass().addClass("fadeInUp animated").find('li[data-value="'+t(this).parent().data("prefix")+'"]').addClass("soul-bf-selected")});y.find(".item-field").off("click").on("click",function(i){i.stopPropagation();t("#main-list"+e).hide();u.hideDropList(n);u.hideCondition(n);u.hideColumns(n);u.hideBfPrefix(n);u.hideBfType(n);var r=t(this).offset().top-t("#soul-bf-column"+e).outerHeight()-10,f=t(this).offset().left;t("#soul-bf-column"+e).find("li.soul-bf-selected").removeClass("soul-bf-selected");t("#soul-bf-column"+e).data("field",t(this).parent().data("field")).data("id",t(this).parent().data("id")).data("mode",t(this).parent().data("mode")).data("group",t(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:r,left:f}).removeClass().addClass("fadeInUp animated").find('li[data-field="'+t(this).parent().data("field")+'"]').addClass("soul-bf-selected")});y.find(".item-type").on("click",function(i){var r,f,o;i.stopPropagation();t("#main-list"+e).hide();u.hideDropList(n);u.hideCondition(n);u.hideColumns(n);u.hideBfColumn(n);u.hideBfPrefix(n);r=t(this).parent().data("field");t("#soul-bf-type"+e+" li").hide();w[r]&&w[r].indexOf("date")===0&&t("#soul-bf-type"+e+" li[data-mode=date]").show();v[r].items.indexOf("data")!==-1&&t("#soul-bf-type"+e+" li[data-mode=in]").show();v[r].items.indexOf("condition")!==-1&&t("#soul-bf-type"+e+" li[data-mode=condition]").show();f=t(this).offset().top-t("#soul-bf-type"+e).outerHeight()-10;o=t(this).offset().left;t("#soul-bf-type"+e).find("li.soul-bf-selected").removeClass("soul-bf-selected");switch(t(this).parent().data("mode")){case"in":t("#soul-bf-type"+e).find('li[data-mode="in"]').addClass("soul-bf-selected");break;case"date":t("#soul-bf-type"+e).find('li[data-mode="date"]').addClass("soul-bf-selected");case"condition":t("#soul-bf-type"+e).find('li[data-value="'+t(this).parent().data("type")+'"]').addClass("soul-bf-selected")}t("#soul-bf-type"+e).data("type",t(this).parent().data("type")).data("mode",t(this).parent().data("mode")).data("id",t(this).parent().data("id")).data("group",t(this).parent().parent().data("id")||"").data("refresh",!0).show().css({top:f,left:o}).removeClass().addClass("fadeInUp animated")});y.find(".item-value").on("click",function(i){var v,y,c,l,o,p;i.stopPropagation();t("#main-list"+e).hide();u.hideColumns(n);u.hideBfType(n);u.hideBfPrefix(n);u.hideBfColumn(n);var l,w=t(this).offset().left,b=t(this).parent().data("mode"),s=t(this).parent().data("field"),a=t(this).parent().data("id"),d=t(this).parent().data("head"),g=t(this).parent().data("prefix");switch(b){case"in":for(u.hideCondition(n),h&&clearTimeout(h),t("#soul-dropList"+e+">.filter-search>input").val(""),t("#soul-dropList"+e).show(),t("#soulDropList"+e).find("."+s+"DropList li input[type=checkbox]:checked").prop("checked",!1),c=u.getFilterSoById(k,a),v=0;v<c.values.length;v++)t("#soulDropList"+e).find("."+s+'DropList li input[type=checkbox][value="'+c.values[v]+'"]').prop("checked",!0);t("#soul-dropList"+e+">ul").data("id",a).data("head",d).data("refresh",!0).data("prefix",g).html(t("#soulDropList"+e).find("."+s+"DropList li").clone());r.render("checkbox","orm");l=t(this).offset().top-t("#soul-dropList"+e).outerHeight()-10;t("#soul-dropList"+e).css({top:l,left:w}).show().removeClass().addClass("fadeInUp animated");setTimeout(function(){t("#soul-dropList"+e+">.filter-search>input").focus()},1);y=!0;r.on("checkbox(soulDropList"+e+")",function(){y=!1;u.updateDropList(n,s)});t("#soul-dropList"+e+">ul>li[data-value]").on("click",function(){y&&t(this).find("div.layui-form-checkbox").trigger("click");y=!0});break;case"date":u.hideDropList(n);f&&clearTimeout(f);c=u.getFilterSoById(k,a);l=t(this).offset().top-10;u.showDate(n,s,c,"fadeInUp",l,w,"up",!0);break;default:u.hideDropList(n);f&&clearTimeout(f);o=this;p=t(this).parents(".condition-item:eq(0)").data("value");t(o).hide();t(o).after('<div><input style="height: 25px;" class="layui-input tempValue" value="" /><\/div>');t(o).next().children().val(p).select().on("keydown",function(n){n.keyCode===13&&t(this).blur()}).on("blur",function(){var i=t(this).val();t(o).html(typeof i=="undefined"||i===""?"请输入...":i);t(o).show();t(this).parent().remove();i!==p&&(u.updateWhere(n,{id:a,value:i}),u.soulReload(n))})}});t("#soul-bf-prefix"+e+">ul>li").off("click").on("click",function(){var r=t(this).parent().parent().data("id"),i=t(this).data("value"),f=t(this).parent().parent().data("prefix"),e=t(this).parent().parent().data("refresh");f!==i&&(u.updateWhere(n,{id:r,prefix:i}),e===!0&&u.soulReload(n))});t("#soul-bf-column"+e+">ul>li").off("click").on("click",function(){var o=t(this).parent().parent().data("field"),r=t(this).data("field"),f=t(this).parent().parent().data("mode"),e=t(this).parent().parent().data("group"),h=t(this).parent().parent().data("refresh"),i;o!==r&&(i={id:t(this).parent().parent().data("id"),field:r},v[r].items.indexOf(nt[f])===-1?t.extend(i,t.extend({},rt[nt[f]],rt[nt[f]].mode==="condition"&&u.startsWith(w[r],"date")?{mode:"date",type:"all"}:{})):f==="in"?t.extend(i,{values:[]}):f!=="date"||u.startsWith(w[r],"date")?f!=="date"&&u.startsWith(w[r],"date")&&t.extend(i,{mode:"date",type:"all"}):t.extend(i,{mode:"condition",type:"eq",value:""}),e&&u.updateWhere(n,{id:e,head:!1}),u.updateWhere(n,i),t(".soul-edit-out").length>0&&(t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-field").html(v[r].title),i.mode==="in"?(t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-type").html("筛选数据"),t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-value").html("共0条数据")):f!==i.mode&&(i.mode==="date"?(t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-type").html("选择日期"),t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-value").html(a[i.type])):i.mode==="condition"&&(t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-type").html(s[i.type]),t('.soul-edit-out li[data-id="'+i.id+'"]').children(".item-value").html(i.value===""?"请输入...":i.value)))),h===!0&&u.soulReload(n))});t("#soul-bf-type"+e+">ul>li").off("click").on("click",function(){var r=t(this).data("value")+"",f=t(this).data("mode"),h=t(this).parent().parent().data("type"),e=t(this).parent().parent().data("mode"),o=t(this).parent().parent().data("group"),c=t(this).parent().parent().data("refresh"),i;if(h!==r){if(i={id:t(this).parent().parent().data("id"),type:r,mode:f},e!==f&&t.extend(i,{value:"",values:[]}),o&&f==="in"&&u.updateWhere(n,{id:o,head:!1}),u.updateWhere(n,i),t(".soul-edit-out").length>0){t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-value").show();t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-type").html(s[r]||(f==="in"?"筛选数据":"选择日期"));switch(f){case"in":t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-value").html("共0条数据");break;case"date":t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-value").html(a[r]);break;case"condition":e!==f&&t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-value").html("请输入...");t('.soul-edit-out li[data-id="'+i.id+'"]').data(i).children(".item-value")[r==="null"||r==="notNull"?"hide":"show"]()}}c===!0&&u.soulReload(n)}});y.find(".condition-items .condition-item .condition-item-close").on("click",function(){u.updateWhere(n,{id:t(this).parents(".condition-item:eq(0)").data("id"),"delete":!0});u.soulReload(n)})},"export":function(n,r){function lt(n){return n?{rgb:n}:n}function nt(n){for(var i=[],t;n;)t=n%26,t||(t=26,--n),String.fromCodePoint||function(n){var t=function(){for(var t,i=[],r=0,f="",u=0,e=arguments.length;u!==e;++u){if(t=+arguments[u],!(t<1114111&&t>>>0===t))throw RangeError("Invalid code point: "+t);t<=65535?r=i.push(t):(t-=65536,r=i.push((t>>10)+55296,t%1024+56320));r>=16383&&(f+=n.apply(null,i),i.length=0)}return f+n.apply(null,i)};try{Object.defineProperty(String,"fromCodePoint",{value:t,configurable:!0,writable:!0})}catch(i){String.fromCodePoint=t}}(String.fromCharCode),i.push(String.fromCodePoint(t+64)),String.fromCodePoint||function(n){var t=function(){for(var t,i=[],r=0,f="",u=0,e=arguments.length;u!==e;++u){if(t=+arguments[u],!(t<1114111&&t>>>0===t))throw RangeError("Invalid code point: "+t);t<=65535?r=i.push(t):(t-=65536,r=i.push((t>>10)+55296,t%1024+56320));r>=16383&&(f+=n.apply(null,i),i.length=0)}return f+n.apply(null,i)};try{Object.defineProperty(String,"fromCodePoint",{value:t,configurable:!0,writable:!0})}catch(i){String.fromCodePoint=t}}(String.fromCharCode),n=~~(n/26);return i.reverse().join("")}var bt,vt,yt,kt,oi,f,u,rt,k,ot,l,ut,o,dt,ft,pt,gt,w,p,st,ht,ct;typeof n=="string"&&(n=e[n]);var si=layer.msg("文件下载中",{icon:16,time:-1,anim:-1,fixed:!1}),a=this.deepClone(n.cols),ni=n.elem.next().find("style")[0],ti=ni.sheet||ni.styleSheet||{},hi=ti.cssRules||ti.rules;layui.each(hi,function(n,t){if(t.style.width){var i=t.selectorText.split("-");a[i[3]][i[4]].width=parseInt(t.style.width)}});var v=JSON.parse(JSON.stringify(n.data||layui.table.cache[n.id])),ii={},ri={},et=[],wt={},ui=t(n.elem),fi=ui.next().children(".layui-table-box").children(".layui-table-body").children("table"),s=typeof n.excel=="undefined"||(n.excel&&(typeof n.excel.on=="undefined"||n.excel.on)?n.excel:!1);s=s===!0?{}:s||{};r=r||{};var at=r.filename?typeof r.filename=="function"?r.filename.call(this):r.filename:s.filename?typeof s.filename=="function"?s.filename.call(this):s.filename:"表格数据.xlsx",ci=r.checked===!0?!0:s.checked===!0,li=r.curPage===!0?!0:s.curPage===!0,tt=typeof r.columns=="undefined"?s.columns:r.columns,ai=typeof r.totalRow=="undefined"?s.totalRow:r.totalRow,vi=at.substring(at.lastIndexOf(".")+1,at.length),g=s.add&&s.add.top&&Array.isArray(s.add.top.data)?s.add.top.data.length+1:1,ei=s.add&&s.add.bottom&&Array.isArray(s.add.bottom.data)?s.add.bottom.data.length:0;if(ci)v=c.checkStatus(n.id).data;else if(li)v=layui.table.cache[n.id];else if(n.url&&n.page){if(bt=!0,vt=it[n.id]?i[n.id]:e[n.id].where,n.contentType&&n.contentType.indexOf("application/json")==0&&(vt=JSON.stringify(vt)),t.ajax({url:n.url,data:vt,dataType:"json",method:n.method||"post",async:!1,cache:!1,headers:n.headers||{},contentType:n.contentType,success:function(t){typeof n.parseData=="function"&&(t=n.parseData(t)||t);t[n.response.statusName]!=n.response.statusCode?layer.msg('返回的数据不符合规范，正确的成功状态码应为："'+n.response.statusName+'": '+n.response.statusCode,{icon:2,anim:6}):v=t[n.response.dataName]},error:function(){layer.msg("请求异常！",{icon:2,anim:6});bt=!1}}),!bt)return}else if(yt=ui.next().children(".layui-table-box").children(".layui-table-header").find('.layui-table-sort[lay-sort$="sc"]:eq(0)'),yt.length>0){kt=yt.parent().parent().data("field");oi=yt.attr("lay-sort");switch(oi){case"asc":v=layui.sort(v,kt);break;case"desc":v=layui.sort(v,kt,!0)}}for(l=[],f=0;f<a.length;f++)for(ut=0,u=0;u<a[f].length;u++)if(a[f][u].exportHandled)(a[f][u].field||a[f][u].type==="numbers")&&!a[f][u].hide||ut++;else{if(a[f][u].rowspan>1)for((a[f][u].field||a[f][u].type==="numbers")&&!a[f][u].hide?et.push([nt(u+1-ut)+(f+g),nt(u+1-ut)+(f+parseInt(a[f][u].rowspan)+g-1)]):ut++,ot=this.deepClone(a[f][u]),ot.exportHandled=!0,rt=f+1;rt<a.length;)a[rt].splice(u,0,ot),rt++;if(a[f][u].colspan>1){for(et.push([nt(u+1-ut)+(f+g),nt(u+parseInt(a[f][u].colspan)-ut)+(f+g)]),ot=this.deepClone(a[f][u]),ot.exportHandled=!0,rt=1;rt<a[f][u].colspan;rt++)a[f].splice(u,0,ot);u=u+parseInt(a[f][u].colspan)-1}}for(o=a[a.length-1],f=0;f<v.length;f++)for(u=0;u<o.length;u++)(o[u].field||o[u].type==="numbers")&&(tt&&Array.isArray(tt)||!o[u].hide)&&(v[f][o[u].key]=v[f][o[u].field||o[u].LAY_TABLE_INDEX]);if(ai!==!1&&n.totalRow){for(dt={},ft={},f=0;f<o.length;f++)o[f].totalRowText?dt[o[f].key]=o[f].totalRowText:o[f].totalRow&&(ft[o[f].key]=0);if(JSON.stringify(ft)!=="{}")for(f=0;f<v.length;f++)for(pt in ft)ft[pt]=(parseFloat(ft[pt])+(parseFloat(v[f][pt])||0)).toFixed(2);v.push(Object.assign(dt,ft))}if(tt&&Array.isArray(tt)){for(gt=[],k={},et=[],l[0]={},f=0;f<tt.length;f++)for(u=0;u<o.length;u++)if(o[u].field===tt[f]){o[u].hide=!1;gt.push(o[u]);l[0][o[u].key]=o[u];k[o[u].key]=o[u].title;break}o=gt;v.splice(0,0,k)}else for(f=0;f<a.length;f++){for(l[f]={},k={},u=0;u<a[f].length;u++)l[f][a[a.length-1][u].key]=a[f][u],k[a[a.length-1][u].key]=a[f][u].title;v.splice(f,0,k)}if(s.add){if(w=s.add.top,p=s.add.bottom,w&&Array.isArray(w.data)&&w.data.length>0){for(f=0;f<w.data.length;f++){for(k={},ct=0,u=0;u<(w.data[f].length>o.length?w.data[f].length:o.length);u++)(o[u].field||o[u].type==="numbers")&&!o[u].hide?k[o[u]?o[u].key:u+""]=w.data[f][u-ct]||"":ct++;v.splice(f,0,k)}if(Array.isArray(w.heights)&&w.heights.length>0)for(f=0;f<w.heights.length;f++)wt[f]=w.heights[f];if(Array.isArray(w.merge)&&w.merge.length>0)for(f=0;f<w.merge.length;f++)w.merge[f].length===2&&(st=w.merge[f][0].split(","),ht=w.merge[f][1].split(","),et.push([nt(st[1])+st[0],nt(ht[1])+ht[0]]))}if(p&&Array.isArray(p.data)&&p.data.length>0){for(f=0;f<p.data.length;f++){for(k={},ct=0,u=0;u<(p.data[f].length>o.length?p.data[f].length:o.length);u++)(o[u].field||o[u].type==="numbers")&&!o[u].hide?k[o[u]?o[u].key:u+""]=p.data[f][u-ct]||"":ct++;v.push(k)}if(Array.isArray(p.heights)&&p.heights.length>0)for(f=0;f<p.heights.length;f++)wt[v.length-p.data.length+f]=p.heights[f];if(Array.isArray(p.merge)&&p.merge.length>0)for(f=0;f<p.merge.length;f++)p.merge[f].length===2&&(st=p.merge[f][0].split(","),ht=p.merge[f][1].split(","),et.push([nt(st[1])+(v.length-p.data.length+parseInt(st[0])),nt(ht[1])+(v.length-p.data.length+parseInt(ht[0]))]))}}var yi=0,pi={left:"left",center:"center",right:"right"},h=["top","bottom","left","right"];for(f=0;f<o.length;f++)(o[f].field||o[f].type==="numbers")&&!o[f].hide&&(o[f].width&&(ri[String.fromCharCode(64+parseInt(++yi))]=o[f].width),ii[o[f].key]=function(n,i,f,e){function it(n){return typeof n=="undefined"||n===null?"":n}var v="ffffff",y="000000",p="Calibri",w=12,nt="s",k=e-(tt?1:a.length)-g+1,o={top:{style:"thin",color:{indexed:64}},bottom:{style:"thin",color:{indexed:64}},left:{style:"thin",color:{indexed:64}},right:{style:"thin",color:{indexed:64}}},c,rt;if(s.border)for(u=0;u<h.length;u++)s.border[h[u]]?(o[h[u]].style=s.border[h[u]].style||o[h[u]].style,o[h[u]].color=lt(s.border[h[u]].color)||o[h[u]].color):(s.border.color||s.border.style)&&(o[h[u]].style=s.border.style||o[h[u]].style,o[h[u]].color=lt(s.border.color)||o[h[u]].color);if(e<g-1||e>=f.length-ei)return{v:i[n]||"",s:{alignment:{horizontal:"center",vertical:"center"},font:{name:p,sz:w,color:{rgb:y}},fill:{fgColor:{rgb:v,bgColor:{indexed:64}}},border:o},t:nt};if(k<0)v="C7C7C7",s.head&&(v=s.head.bgColor||v,y=s.head.color||y,p=s.head.family||p,w=s.head.size||w),r.head&&(v=r.head.bgColor||v,y=r.head.color||y,p=r.head.family||p,w=r.head.size||w);else{if(s.font&&(v=s.font.bgColor||v,y=s.font.color||y,p=s.font.family||p,w=s.font.size||w),r.font&&(v=r.font.bgColor||v,y=r.font.color||y,p=r.font.family||p,w=r.head.size||w),r.border)for(u=0;u<h.length;u++)r.border[h[u]]?(o[h[u]].style=r.border[h[u]].style||o[h[u]].style,o[h[u]].color=lt(r.border[h[u]].color)||o[h[u]].color):(r.border.color||r.border.style)&&(o[h[u]].style=r.border.style||o[h[u]].style,o[h[u]].color=lt(r.border.color)||o[h[u]].color);if(l[l.length-1][n].excel&&(c=typeof l[l.length-1][n].excel=="function"?l[l.length-1][n].excel.call(this,i,k,f.length-a.length-g+1-ei):l[l.length-1][n].excel,c&&(v=c.bgColor||v,y=c.color||y,p=c.family||p,w=c.size||w,nt=c.cellType||nt,c.border)))for(u=0;u<h.length;u++)c.border[h[u]]?(o[h[u]].style=c.border[h[u]].style||o[h[u]].style,o[h[u]].color=lt(c.border[h[u]].color)||o[h[u]].color):(c.border.color||c.border.style)&&(o[h[u]].style=c.border.style||o[h[u]].style,o[h[u]].color=lt(c.border.color)||o[h[u]].color)}return rt=k>=0&&l[l.length-1][n].templet?typeof l[l.length-1][n].templet=="function"?t("<div>"+l[l.length-1][n].templet(i)+"<\/div>").find(":input").length===0?t("<div>"+l[l.length-1][n].templet(i)+"<\/div>").text():fi.children("tbody").children("tr[data-index="+k+"]").children('td[data-field="'+n+'"]').find(":input").val()||it(i[n]):t("<div>"+b(t(l[l.length-1][n].templet).html()||String(l[l.length-1][n].templet)).render(i)+"<\/div>").find(":input").length===0?t("<div>"+b(t(l[l.length-1][n].templet).html()||String(l[l.length-1][n].templet)).render(i)+"<\/div>").text():fi.children("tbody").children("tr[data-index="+k+"]").children('td[data-field="'+n+'"]').find(":input").val()||it(i[n]):k>=0&&l[l.length-1][n].type==="numbers"?k+1:it(i[n]),{v:rt,s:{alignment:{horizontal:l[k<-1?e-g+1:l.length-1][n].align?pi[l[k<-1?e-g+1:l.length-1][n].align]:"top",vertical:"center"},font:{name:p,sz:w,color:{rgb:y}},fill:{fgColor:{rgb:v,bgColor:{indexed:64}}},border:o},t:d.indexOf(rt)===-1?nt:"s"}});y.exportExcel({sheet1:y.filterExportData(v,ii)},at,vi,{extend:{"!cols":y.makeColConfig(ri,80),"!merges":y.makeMergeConfig(et),"!rows":y.makeRowConfig(wt,16)}});layer.close(si)},startsWith:function(n,t){var i=new RegExp("^"+t);return n&&i.test(n)},deepClone:function(n){var i=Array.isArray(n)?[]:{},t;if(n&&typeof n=="object")for(t in n)n.hasOwnProperty(t)&&(i[t]=n&&typeof n[t]=="object"?this.deepClone(n[t]):n[t]);return i},deepStringify:function(n){var t={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.stringify(n,function(n,i){return typeof i=="function"?t.PREFIX+i.toString()+t.SUFFIX:i})},getScrollWidth:function(n){var t=0;return n?t=n.offsetWidth-n.clientWidth:(n=document.createElement("div"),n.style.width="100px",n.style.height="100px",n.style.overflowY="scroll",document.body.appendChild(n),t=n.offsetWidth-n.clientWidth,document.body.removeChild(n)),t},getCompleteCols:function(n){for(var t=this.deepClone(n),i,u,f,r=0;r<t.length;r++)for(i=0;i<t[r].length;i++)if(!t[r][i].exportHandled){if(t[r][i].rowspan>1)for(f=this.deepClone(t[r][i]),f.exportHandled=!0,u=r+1;u<t.length;)t[u].splice(i,0,f),u++;if(t[r][i].colspan>1){for(f=this.deepClone(t[r][i]),f.exportHandled=!0,u=1;u<t[r][i].colspan;u++)t[r].splice(i,0,f);i=i+parseInt(t[r][i].colspan)-1}}return t[t.length-1]},parseTempData:function(n,i,r,u){var f=n.templet?function(){return typeof n.templet=="function"?n.templet(r):b(t(n.templet).html()||String(i)).render(r)}():i;return u?t("<div>"+f+"<\/div>").text():f},cache:u};n("tableFilter",ot)});