/**
 *
 * @name:  表格增强插件
 * @author: yelog
 * @link: https://github.com/yelog/layui-soul-table
 * @license: MIT
 * @version: v1.5.15
 */
layui.define(["table","tableFilter","tableChild","tableMerge"],function(n){var r=layui.tableFilter,s=layui.tableChild,h=layui.tableMerge,t=layui.$,i=layui.table,f="layui-hide",e={},u={},o={fixTotal:!1,drag:!0,rowDrag:!1,autoColumnWidth:!0,contextmenu:!1,fixResize:!0,overflow:!1,fixFixedScroll:!0,filter:!1},c={render:function(n){var i,f,c,l;e[n.id]=n;i=t.extend({},o,n);i.filter&&i.filter.cache?(f=location.pathname+location.hash+n.id,c=this.deepStringify(n.cols),u[n.id]||(u[n.id]=this.deepClone(n.cols),l=localStorage.getItem(f),l&&c===localStorage.getItem("origin"+f)?this.updateCols(n,this.deepParse(l)):(localStorage.setItem("origin"+f,c),localStorage.removeItem(f)))):this.clearCache(n);r.render(n);s.render(n);h.render(n);i.fixTotal&&this.fixTotal(n);i.drag&&this.drag(n,i.drag);i.rowDrag&&this.rowDrag(n,i.rowDrag);i.autoColumnWidth&&this.autoColumnWidth(n,i.autoColumnWidth);this.contextmenu(n,i.contextmenu);i.fixResize&&this.fixResizeRightFixed(n);i.overflow&&this.overflow(n,i.overflow);i.fixFixedScroll&&this.fixFixedScroll(n)},config:function(n){typeof n=="object"&&t.extend(!0,o,n)},updateCols:function(n,u){function y(i,r){var o,h;for(f=0;f<u.length;f++)for(e=0;e<u[f].length;e++)s=n.index+"-"+u[f][e].key,o=t(i).children(r+":eq("+e+")").attr("data-key"),o!==s&&(t(i).children(r+":eq("+e+")").before(t(i).children(r+'[data-key="'+s+'"]')),u[f][e].fixed&&(h=(r==="th"?a:v).children().children(r==="th"?"tr":'tr[data-index="'+t(i).attr("data-index")+'"]'),h.children(r+'[data-key="'+o+'"]').before(h.children(r+'[data-key="'+s+'"]'))))}for(var e,o={},s,l=[],c=[],p=t(n.elem),h=p.next().children(".layui-table-box"),a=h.children(".layui-table-fixed").children(".layui-table-header").children("table"),w=t.merge(h.children(".layui-table-header").children("table"),a),b=h.children(".layui-table-header").children("table"),v=h.children(".layui-table-fixed").children(".layui-table-body").children("table"),k=h.children(".layui-table-body").children("table"),d=t.merge(h.children(".layui-table-body").children("table"),v),f=0;f<n.cols.length;f++)for(e=0;e<n.cols[f].length;e++)n.cols[f][e].oldPos=f+"-"+e,o[n.cols[f][e].key]=n.cols[f][e];for(f=0;f<u.length;f++){for(c=[],e=0;e<u[f].length;e++){if(s=n.index+"-"+u[f][e].key,u[f][e].width&&o[u[f][e].key]!==u[f][e].width&&this.getCssRule(n,s,function(n){n.style.width=(u[f][e].width?u[f][e].width:0)+"px"}),o[u[f][e].key].hide!==u[f][e].hide&&(w.find('th[data-key="'+s+'"]')[u[f][e].hide?"addClass":"removeClass"]("layui-hide"),d.find('td[data-key="'+s+'"]')[u[f][e].hide?"addClass":"removeClass"]("layui-hide")),(o[u[f][e].key].oldPos!==f+"-"+e||o[u[f][e].key].fixed!==u[f][e].fixed)&&u[f][e].fixed!==o[u[f][e].key].fixed){n.cols=u;i.reload(n.id);return}o[u[f][e].key].fixed=u[f][e].fixed;o[u[f][e].key].width=u[f][e].width;o[u[f][e].key].hide=u[f][e].hide;c.push(o[u[f][e].key])}l.push(c)}b.children().children("tr").each(function(){y(this,"th")});k.children().children("tr").each(function(){y(this,"td")});n.cols=l;r.resize(n)},"export":function(n,t){r.export(n.config||n,t)},getCssRule:function(n,t,i){var r=n.elem.next().find("style")[0],u=r.sheet||r.styleSheet||{},f=u.cssRules||u.rules;layui.each(f,function(n,r){if(r.selectorText===".laytable-cell-"+t)return i(r),!0})},autoColumnWidth:function(n,i){function u(n,r){function s(i,r,u){var c=r.data("key"),a=c.split("-"),y=a.length===3?a[1]+"-"+a[2]:"",f,l,v,e,s;if(!(r.attr("colspan")>1)&&u)for(f=r.text().width(r.css("font"))+21,l=r.css("font"),h.children('td[data-key="'+c+'"]').each(function(){var n=0;t(this).children().children()&&t(this).children().children().length>0?n+=t(this).children().html().width(l):n=t(this).text().width(l);f<n&&(f=n)}),o.length>0&&(v=o.children('td[data-key="'+c+'"]').text().width(l),f<v&&(f=v)),f+=32,n.getCssRule(i,c,function(n){n.style.width=f+"px"}),e=0;e<i.cols.length;e++)for(s=0;s<i.cols[e].length;s++)if(i.cols[e][s].key===y){i.cols[e][s].width=f;break}}var u=t(r.elem),f=u.next().children(".layui-table-box").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),e=u.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),h=u.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr"),o=u.next().children(".layui-table-total").find("tr");if(String.prototype.width=function(n){var r=n||t("body").css("font"),i=t("<div>"+this+"<\/div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:r}).appendTo(t("body")),u=i.width();return i.remove(),u},typeof i=="undefined"||typeof i.dblclick=="undefined"||i.dblclick)f.add(e).on("dblclick",function(n){var i=t(this),u=n.clientX-i.offset().left;s(r,i,i.parents(".layui-table-fixed-r").length>0?u<=10:i.width()-u<=10)});i&&i.init&&f.add(e).each(function(){var n=t(this).attr("data-key").split("-");r.cols[n[1]][n[2]].autoWidth===!1||Array.isArray(i.init)&&i.init.indexOf(t(this).attr("data-field"))===-1||s(r,t(this),!0)})}var r=this;typeof n=="object"?u(r,n):typeof n=="string"?u(r,e[n]):typeof n=="undefined"&&layui.each(e,function(){u(r,this)})},drag:function(n,u){var s;if(!(n.cols.length>1)){var l=this,a=t(n.elem),e=a.next().children(".layui-table-box"),v=t.merge(e.children(".layui-table-header").children("table"),e.children(".layui-table-fixed").children(".layui-table-header").children("table")),w=e.children(".layui-table-fixed").children(".layui-table-body").children("table"),g=e.children(".layui-table-body").children("table"),h=t.merge(e.children(".layui-table-body").children("table"),w),o=a.next().children(".layui-table-total").children("table"),k=a.next().children(".layui-table-total").children("table.layui-table-total-fixed"),nt=a.next().children(".layui-table-total").children("table:eq(0)"),c=n.id,d=u==="simple"||u&&u.type==="simple",b=u&&u.toolbar,y=!1,p=!1;if(!v.attr("drag")){if(v.attr("drag",!0),b){e.append('<div class="soul-drag-bar"><div data-type="left">左固定<\/div><div data-type="none">不固定<\/div><div data-type="right">右固定<\/div><\/div>');s=e.children(".soul-drag-bar");s.children("div").on("mouseenter",function(){t(this).addClass("active")}).on("mouseleave",function(){t(this).removeClass("active")})}v.find("th").each(function(){var u=t(this),tt=u.data("field"),a=u.data("key");if(a){var rt=a.split("-"),it=n.cols[rt[1]][rt[2]],ut=rt[1]+"-"+rt[2],ft=u.parents(".layui-table-fixed").length>0;t(this).find("span:first,.laytable-cell-checkbox").css("cursor","move").on("mousedown",function(rt){if(rt.button===0){rt.preventDefault();var et=u.clone().css("visibility","hidden"),lt=u.position().left,ht=u.offset().top,at=rt.clientX-lt,vt=u.parents("tr:eq(0)").css("background-color"),st=u.width(),yt=0,ct=t(this),ot=it.fixed;p=!0;t(document).bind("selectstart",function(){return!1});t("body").on("mousemove",function(i){if(p&&et){e.removeClass("no-left-border");y||(b&&(s.attr("data-type",ot||"none"),s.addClass("active")),u.after(et),u.addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":vt,width:st+1}),d||((ft?w:h).find('td[data-key="'+a+'"]').each(function(){t(this).after(t(this).clone().css("visibility","hidden").attr("data-clone",""));t(this).addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":t(this).css("background-color"),width:st+1})}),o.length>0&&(ft?k:o).find('td[data-key="'+a+'"]').each(function(){t(this).after(t(this).clone().css("visibility","hidden").attr("data-clone",""));t(this).addClass("isDrag").css({position:"absolute","z-index":1,"background-color":t(this).parents("tr:eq(0)").css("background-color"),width:st+1})})));y=!0;var r,f,v,g,it,nt=i.clientX-at,rt=et.prev().prev(),lt=rt.length>0,kt=lt?rt.data("key").split("-"):[],ct=et.next().hasClass("layui-table-patch")?[]:et.next(),pt=ct.length>0,dt=pt?ct.data("key").split("-"):[],wt=lt&&et.position().left-nt>rt.width()/2,bt=pt&&nt-et.position().left>ct.width()/2;if(yt=Math.abs(et.position().left-nt),et.position().left-nt>0?!lt||!!ot!=!!n.cols[kt[1]][kt[2]].fixed:!pt||!!ot!=!!n.cols[dt[1]][dt[2]].fixed){u.css("left",et.position().left);h.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().css("left",et.position().left)});o.length>0&&o.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().css("left",et.position().left)});e.addClass("no-left-border");return}if(u.css("left",nt),wt){for(et.after(rt),t("#soul-columns"+c+'>li[data-value="'+tt+'"]').after(t("#soul-columns"+c+'>li[data-value="'+tt+'"]').prev()),v=0;v<n.cols.length;v++){for(g=0;g<n.cols[v].length;g++)if(n.cols[v][g].key===ut){r=v;f=g;break}if(typeof r!="undefined"&&typeof f!="undefined")break}it=n.cols[r][f-1];n.cols[r][f-1]=n.cols[r][f];n.cols[r][f]=it;l.fixTableRemember(n)}else if(bt){for(et.prev().before(ct),t("#soul-columns"+c+'>li[data-value="'+tt+'"]').before(t("#soul-columns"+c+'>li[data-value="'+tt+'"]').next()),v=0;v<n.cols.length;v++){for(g=0;g<n.cols[v].length;g++)if(n.cols[v][g].key===ut){r=v;f=g;break}if(typeof r!="undefined"&&typeof f!="undefined")break}it=n.cols[r][f+1];n.cols[r][f+1]=n.cols[r][f];n.cols[r][f]=it;l.fixTableRemember(n)}h.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().css("left",nt);wt?t(this).prev().prev().length!==0&&t(this).after(t(this).prev().prev()):bt&&t(this).next().length!==0&&t(this).prev().before(t(this).next())});o.length>0&&o.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().css("left",nt);wt?t(this).prev().prev().length!==0&&t(this).after(t(this).prev().prev()):bt&&t(this).next().length!==0&&t(this).prev().before(t(this).next())});i.clientY-ht<-15?(t("#column-remove").length===0&&t("body").append('<i id="column-remove" class="layui-red layui-icon layui-icon-delete"><\/i>'),t("#column-remove").css({top:i.clientY-t("#column-remove").height()/2,left:i.clientX-t("#column-remove").width()/2,"font-size":ht-i.clientY+"px"}),t("#column-remove").show()):t("#column-remove").hide()}}).on("mouseup",function(){var ht,at,vt,rt,st,yt,lt;if(t(document).unbind("selectstart"),t("body").off("mousemove").off("mouseup"),p&&et){if(p=!1,y){if(it.type!=="checkbox")ct.on("click",function(n){n.stopPropagation()});if(y=!1,e.removeClass("no-left-border"),u.removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),u.next().remove(),ht=u.prev().data("key"),ot&&(at=e.children(".layui-table-header").children("table").find('th[data-key="'+a+'"]'),ht?at.parent().children('th[data-key="'+ht+'"]').after(at):ot==="right"?u.siblings().length>0&&e.children(".layui-table-header").children("table").find('th[data-key="'+u.next().data("key")+'"]').prev().after(at):(at.parent().prepend('<th class="layui-hide"><\/th>'),at.parent().children("th:first").after(at),at.parent().children("th:first").remove())),d?(h.find('td[data-key="'+a+'"]').each(function(){if(ht)t(this).parent().children('td[data-key="'+ht+'"]').after(t(this));else if(ot==="right"){if(u.siblings().length>0){var n=t(this).parent().children('td[data-key="'+u.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),o.length>0&&o.find('td[data-key="'+a+'"]').each(function(){if(ht)t(this).parent().children('td[data-key="'+ht+'"]').after(t(this));else if(ot==="right"){var n=t(this).parent().children('td[data-key="'+u.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()})):ft?(g.find('td[data-key="'+a+'"]').each(function(){if(ht)t(this).parent().children('td[data-key="'+ht+'"]').after(t(this));else if(ot==="right"){if(u.siblings().length>0){var n=t(this).parent().children('td[data-key="'+u.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),w.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}),o.length>0&&(nt.find('td[data-key="'+a+'"]').each(function(){if(ht)t(this).parent().children('td[data-key="'+ht+'"]').after(t(this));else if(ot==="right"){var n=t(this).parent().children('td[data-key="'+u.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),k.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}))):(h.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}),o.length>0&&o.find('td[data-key="'+a+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()})),et=null,b){if(s.children(".active").length>0&&s.children(".active").attr("data-type")!==s.attr("data-type")){for(vt=s.children(".active").attr("data-type"),rt=0;rt<n.cols.length;rt++)for(st=0;st<n.cols[rt].length;st++)vt==="right"||vt==="none"&&s.attr("data-type")==="right"?typeof lt=="undefined"&&(n.cols[rt][st].fixed==="right"?lt={x:rt,y:st}:st===n.cols[rt].length-1&&(lt={x:rt,y:st+1})):typeof lt!="undefined"||n.cols[rt][st].fixed&&n.cols[rt][st].fixed!=="right"||(lt={x:rt,y:st}),n.cols[rt][st].key===ut&&(yt={x:rt,y:st});it.fixed=vt==="none"?!1:vt;yt.y!==lt.y&&(n.cols[yt.x].splice(yt.y,1),yt.y<lt.y&&(lt.y-=1),n.cols[lt.x].splice(lt.y,0,it),l.fixTableRemember(n));i.reload(c)}s.removeClass("active")}}else ct.unbind("click");t("#column-remove").is(":visible")&&(v.find("thead>tr>th[data-key="+a+"]").addClass(f),h.find('tbody>tr>td[data-key="'+a+'"]').addClass(f),o.find('tbody>tr>td[data-key="'+a+'"]').addClass(f),it.hide=!0,l.fixTableRemember(n),t("#soul-columns"+c).find('li[data-value="'+tt+'"]>input').prop("checked",!1),r.resize(n));t("#column-remove").hide()}})}})}})}}},rowDrag:function(n,r){var y=this,c=t(n.elem),f=c.next().children(".layui-table-box"),l=f.children(".layui-table-fixed").children(".layui-table-body").children("table"),a=f.children(".layui-table-body").children("table"),v=t.merge(f.children(".layui-table-body").children("table"),l),w=n.id,h=!1,e=r.trigger||"row",b=r.numbers!==!1,o=null,p=0,k=e==="row"?v.children("tbody").children("tr"):v.find(e),u,s;for(e!=="row"&&v.find(e).css("cursor","move"),u=0;u<n.cols.length;u++)for(s=0;s<n.cols[u].length;s++)if(n.cols[u][s].type==="numbers"){o=n.index+"-"+u+"-"+s;p=parseInt(a.find('td[data-key="'+o+'"]:first').text());break}k.on("mousedown",function(s){if(s.button===0){var nt=e==="row"?t(this):t(this).parents("tr:eq(0)"),k=parseInt(nt.data("index")),v=a.children("tbody").children("tr[data-index="+k+"]"),g=v.clone().css("visibility","hidden"),d=l.children("tbody").children("tr[data-index="+k+"]"),tt=f.children(".layui-table-body").scrollTop(),it=nt.position().top,rt=s.clientY-it;t("body").on("mousemove",function(n){function i(n,t){var i=parseInt(n.data("index"))+t;return n.data("index",i),n.attr("data-index",i),n}var e,o;h||(h=!0,e=c.next().find("style")[0],o=e.sheet||e.styleSheet||{},y.addCSSRule(o,".layui-table-view .layui-table td","cursor: move"),y.addCSSRule(o,".layui-table tr","transition: none"),f.addClass("noselect"),v.after(g),v.css({position:"absolute","z-index":1}),d.each(function(){t(this).after(t(this).clone().css("visibility","hidden"));t(this).css({position:"absolute","z-index":102})}));var r=n.clientY-rt+(f.children(".layui-table-body").scrollTop()-tt),u=g.position().top,s=v.prev(),a=s.length>0,l=g.next(),p=l.length>0,w=a&&u-r>s.height()/2,b=p&&r-u>l.height()/2;if(u-r>0?!a:!p){v.css("top",u);d.each(function(){t(this).css("top",u)});return}v.css("top",r);d.each(function(){t(this).css("top",r)});w?(i(v,-1),g.after(i(s,1)),d.each(function(){i(t(this),-1);t(this).next().after(i(t(this).prev(),1))})):b&&(i(v,1).before(i(l,-1)),d.each(function(){i(t(this),1);t(this).before(i(t(this).next().next(),-1))}))}).on("mouseup",function(){var e,s,g,tt,y;if(t("body").off("mousemove").off("mouseup"),h){h=!1;f.removeClass("noselect");v.css({position:"inherit","z-index":"inherit"});v.next().remove();d.each(function(){t(this).css({position:"inherit","z-index":"inherit"});t(this).next().remove()});var it=c.next().find("style")[0],rt=it.sheet||it.styleSheet||{},ut=rt.cssRules||rt.rules;if(layui.each(ut,function(n,t){t.selectorText===".layui-table-view .layui-table td"&&(t.style.cursor="default")}),e=nt.index(),e!==k){if(s=i.cache[w],g=s.splice(k,1)[0],s.splice(e,0,g),o&&b)for(tt=[e,k].sort(),u=tt[0];u<=tt[1];u++)y=p+u,l.find('td[data-key="'+o+'"]:eq('+u+")").children().html(y),a.find('td[data-key="'+o+'"]:eq('+u+")").children().html(y),s[u][i.config.indexName]=y-1;typeof r.done=="function"&&r.done.call(n,{row:g,newIndex:e,oldIndex:k,cache:s})}}})}})},fixTableRemember:function(n,t){var u,i,r,f;if(typeof n.filter=="undefined"?o.filter&&o.filter.cache:n.filter.cache){if(t&&t.rule)for(u=t.rule.selectorText.split("-")[3]+"-"+t.rule.selectorText.split("-")[4],i=0;i<n.cols.length;i++)for(r=0;r<n.cols[i].length;r++)if(n.cols[i][r].key===u){n.cols[i][r].width=t.rule.style.width.replace("px","");break}f=location.pathname+location.hash+n.id;localStorage.setItem(f,this.deepStringify(n.cols))}},clearCache:function(n){if(n){var t;t=typeof n=="object"?typeof n.config!="undefined"?n.config.id:n.id:n;localStorage.removeItem(location.pathname+location.hash+t);u[t]&&this.updateCols(e[t],this.deepClone(u[t]))}},overflow:function(n,i){var r={};if(typeof i=="string")r={type:i};else if(typeof i=="object")r=i;else return;var e=t(n.elem),s=e.next().find(".layui-table-header"),h=e.next().find(".layui-table-body"),c=e.next().find(".layui-table-total"),l,o=r.hoverTime||0,f,y=r.color||"white",p=r.bgColor||"black",a=r.minWidth||300,v=r.maxWidth||300;if(r.type==="tips"){h.off("mouseenter","td").off("mouseleave","td").on("mouseenter","td",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","td",function(){u.call(this,"hide")});if(r.header)s.off("mouseenter","th").off("mouseleave","th").on("mouseenter","th",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","th",function(){u.call(this,"hide")});if(r.total)c.off("mouseenter","td").off("mouseleave","td").on("mouseenter","td",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","td",function(){u.call(this,"hide")});function u(n){clearTimeout(f);var r=t(this),u=r.children(".layui-table-cell"),i=u.outerWidth(),e=i<a?a:i>v?v:i;r.data("off")||(n?layer.close(l):u.prop("scrollWidth")>i&&(l=layer.tips('<span style="color: '+y+'">'+t(this).text()+"<\/span>",this,{tips:[1,p],maxWidth:e,time:0})))}}else if(r.type==="title"){h.off("mouseenter","td").on("mouseenter","td",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())});if(r.header)s.off("mouseenter","th").on("mouseenter","th",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())});if(r.total)c.off("mouseenter","td").on("mouseenter","td",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())})}},contextmenu:function(n,r){function h(r,u,f,e,o,c,l,a){var p=[],v,y;for(p.push('<ul class="soul-table-contextmenu">'),v=0;v<e.length;v++)p.push('<li data-index="'+v+'" class="'+(e[v].children&&e[v].children.length>0?"contextmenu-children":"")+'">'),e[v].icon?p.push('<i class="prefixIcon '+e[v].icon+'" />'):p.push('<i class="prefixIcon" />'),p.push(e[v].name),e[v].children&&e[v].children.length>0&&p.push('<i class="endIcon layui-icon layui-icon-right" />'),p.push("<\/li>");for(p.push("<\/ul>"),r.append(p.join("")),y=r.children().last(),f+y.outerHeight()>t("body").prop("scrollHeight")&&(f=f-y.outerHeight(),f<0&&(f=0)),r.parent().data("direction")==="left"&&r.offset().left-y.outerWidth()>0?(u=-y.outerWidth(),y.data("direction","left")):u+y.outerWidth()+r.offset().left>t("body").prop("scrollWidth")&&(u=u-y.outerWidth()-r.outerWidth(),u+r.offset().left<0&&(u=-r.offset().left),y.data("direction","left")),y.css({top:f+"px",left:u+"px"}),v=0;v<e.length;v++)typeof e[v].click=="function"&&function(u){r.children(".soul-table-contextmenu:last").children('li[data-index="'+u+'"]').on("click",function(){var r=o.parents("tr:eq(0)").data("index"),h=c.find('tr[data-index="'+r+'"]'),f=layui.table.cache[s][r];e[u].click.call(n,{cell:o,elem:l==="th"?o:a?c.children("tbody").children('tr[data-index="'+r+'"]').children('[data-key="'+o.data("key")+'"]'):c.find('[data-key="'+o.data("key")+'"]'),trElem:c.children("tbody").children('tr[data-index="'+r+'"]'),text:o.text(),field:o.data("field"),del:a?function(){i.cache[s][r]=[];h.remove();i.resize(s)}:"",update:a?function(n){n=n||{};layui.each(n,function(n,r){if(n in f){var u,e=h.children('td[data-field="'+n+'"]');f[n]=r;i.eachCols(s,function(t,i){i.field==n&&i.templet&&(u=i.templet)});e.children(".layui-table-cell").html(function(){return u?function(){return typeof u=="function"?u(f):layui.laytpl(t(u).html()||r).render(f)}():r}());e.data("content",r)}})}:"",row:a?f:{}});t("#soul-table-contextmenu-wrapper").remove()})}(v);r.children(".soul-table-contextmenu:last").children("li").on("mouseenter",function(n){n.stopPropagation();t(this).siblings(".contextmenu-children").children("ul").remove();t(this).hasClass("contextmenu-children")&&h(t(this),t(this).outerWidth(),t(this).position().top,e[t(this).data("index")].children,o,c,l,a)})}for(var e,a,c=t(n.elem),o=c.next().children(".layui-table-box"),v=t.merge(o.children(".layui-table-header").children("table"),o.children(".layui-table-fixed").children(".layui-table-header").children("table")),y=o.children(".layui-table-fixed").children(".layui-table-body").children("table"),p=t.merge(o.children(".layui-table-body").children("table"),y),w=c.next().children(".layui-table-total").children("table"),s=n.id,b=r?r.header:"",k=r?r.body:"",d=r?r.total:"",u={header:{box:v,tag:"th",opts:b,cols:{}},body:{box:p,tag:"td",opts:k,cols:{},isBody:!0},total:{box:w,tag:"td",opts:d,cols:{}}},l=!1,f=0;f<n.cols.length;f++)for(e=0;e<n.cols[f].length;e++)n.cols[f][e].contextmenu&&(l=!0,u.header.cols[n.cols[f][e].key]=n.cols[f][e].contextmenu.header,u.body.cols[n.cols[f][e].key]=n.cols[f][e].contextmenu.body,u.total.cols[n.cols[f][e].key]=n.cols[f][e].contextmenu.total);if(r||l){for(a in u)(function(n){u[n].box.find(u[n].tag).on("contextmenu",function(i){t("#soul-table-contextmenu-wrapper").remove();t("body").append('<div id="soul-table-contextmenu-wrapper"><\/div>');t("#soul-table-contextmenu-wrapper").on("click",function(n){n.stopPropagation()});var r=u[n].cols[t(this).data("key").substr(t(this).data("key").indexOf("-")+1)];return r===!1?!1:r&&r.length>0?(h(t("#soul-table-contextmenu-wrapper"),i.pageX,i.pageY,r,t(this),u[n].box,u[n].tag,u[n].isBody),!1):u[n].opts===!1?!1:u[n].opts&&u[n].opts.length>0?(h(t("#soul-table-contextmenu-wrapper"),i.pageX,i.pageY,u[n].opts,t(this),u[n].box,u[n].tag,u[n].isBody),!1):void 0})})(a);t("body").on("click",function(){t("#soul-table-contextmenu-wrapper").remove()})}},fixTotal:function(n){var u=t(n.elem),r=u.next().children(".layui-table-total"),e=u.next().find("style")[0],f=e.sheet||e.styleSheet||{};if(r.length>0){var o=u.next().children(".layui-table-box"),s=o.children(".layui-table-fixed-l").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),h=o.children(".layui-table-fixed-r").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),i=[];r.children(".layui-table-total-fixed").remove();s.length>0&&(this.addCSSRule(f,".layui-table-total-fixed-l .layui-table-patch","display: none"),u.next().css("position","relative"),i.push('<table style="position: absolute;background-color: #fff;left: 0;top: '+(r.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-l"><tbody><tr>'),s.each(function(){t(this).data("key")&&i.push(r.children("table:eq(0)").find('[data-key="'+t(this).data("key")+'"]').prop("outerHTML"))}),i.push("<\/tr><\/tbody><\/table>"),r.append(i.join("")));h.length>0&&(this.addCSSRule(f,".layui-table-total-fixed-r td:first-child","border-left:1px solid #e6e6e6"),this.addCSSRule(f,".layui-table-total-fixed-r td:last-child","border-left: none"),u.next().css("position","relative"),i=[],i.push('<table style="position: absolute;background-color: #fff;right: 0;top: '+(r.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-r"><tbody><tr>'),h.each(function(){i.push(r.children("table:eq(0)").find('[data-key="'+t(this).data("key")+'"]').prop("outerHTML"))}),i.push("<\/tr><\/tbody><\/table>"),r.append(i.join("")))}},fixResizeRightFixed:function(n){var o=this,h=t(n.elem),c=h.next().children(".layui-table-box"),s=c.children(".layui-table-fixed-r").children(".layui-table-header").children("table"),i={},r=t("body"),l=t(document),u,f="layui-table-sort",e="layui-table-sort-invalid";if(s.length>0){s.find("th").off("mousemove").on("mousemove",function(n){var u=t(this),e=u.offset().left,f=n.clientX-e;u.data("unresize")||i.resizeStart||(u.width()-f<=10&&r.css("cursor","initial"),i.allowResize=f<=10,r.css("cursor",i.allowResize?"col-resize":""))}).off("mousedown").on("mousedown",function(r){var u=t(this),s;i.allowResize&&(u.find("."+f).removeClass(f).addClass(e),s=u.data("key"),r.preventDefault(),i.resizeStart=!0,i.offset=[r.clientX,r.clientY],o.getCssRule(n,s,function(t){var r=t.style.width||u.outerWidth();i.rule=t;i.ruleWidth=parseFloat(r);i.othis=u;i.minWidth=u.data("minwidth")||n.cellMinWidth}))});l.on("mousemove",function(t){if(i.resizeStart){if(layui.soulTable.fixTableRemember(n,i),t.preventDefault(),i.rule){var r=i.ruleWidth-t.clientX+i.offset[0];r<i.minWidth&&(r=i.minWidth);i.rule.style.width=r+"px"}u=1}}).on("mouseup",function(){i.resizeStart&&setTimeout(function(){i.othis.find("."+e).removeClass(e).addClass(f);r.css("cursor","");i={};o.scrollPatch(n)},30);u===2&&(u=null)})}},fixFixedScroll:function(n){var i=t(n.elem),r=i.next().children(".layui-table-box").children(".layui-table-fixed"),u=i.next().children(".layui-table-box").children(".layui-table-main");r.on("mouseenter",function(){t(this).children(".layui-table-body").addClass("soul-fixed-scroll").on("scroll",function(){var n=t(this).scrollTop();u.scrollTop(n)})}).on("mouseleave",function(){t(this).children(".layui-table-body").removeClass("soul-fixed-scroll").off("scroll")})},scrollPatch:function(n){var r=t(n.elem),a=r.next().children(".layui-table-box").children(".layui-table-header"),v=r.next().children(".layui-table-total"),i=r.next().children(".layui-table-box").children(".layui-table-main"),y=r.next().children(".layui-table-box").children(".layui-table-fixed"),o=r.next().children(".layui-table-box").children(".layui-table-fixed-r"),s=i.children("table"),u=i.width()-i.prop("clientWidth"),h=i.height()-i.prop("clientHeight"),p=s.outerWidth()-i.width(),c=function(n){if(u&&h){if(n=n.eq(0),!n.find(".layui-table-patch")[0]){var i=t('<th class="layui-table-patch"><div class="layui-table-cell"><\/div><\/th>');i.find("div").css({width:u});n.find("tr").append(i)}}else n.find(".layui-table-patch").remove()},l,e;c(a);c(v);l=i.height();e=l-h;y.find(".layui-table-body").css("height",s.height()>=e?e:"auto");o[p>0?"removeClass":"addClass"](f);o.css("right",u-1)},copy:function(n){var t,i;n?(t=document.createElement("div"),t.id="tempTarget",t.style.opacity="0",t.innerText=n,document.body.appendChild(t)):t=document.querySelector("#"+id);try{i=document.createRange();i.selectNode(t);window.getSelection().removeAllRanges();window.getSelection().addRange(i);document.execCommand("copy");window.getSelection().removeAllRanges()}catch(r){console.log("复制失败")}n&&t.parentElement.removeChild(t)},addCSSRule:function(n,t,i,r){"insertRule"in n?n.insertRule(t+"{"+i+"}",r):"addRule"in n&&n.addRule(t,i,r)},deepStringify:function(n){var t={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.stringify(n,function(n,i){return typeof i=="function"?t.PREFIX+i.toString()+t.SUFFIX:i})},deepParse:function(n){var t={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.parse(n,function(n,i){return typeof i=="string"&&i.indexOf(t.SUFFIX)>0&&i.indexOf(t.PREFIX)===0?eval("("+i.replace(t.PREFIX,"").replace(t.SUFFIX,"")+")"):i})||{}},clearFilter:function(n){r.clearFilter(n)},cache:r.cache,deepClone:function(n){var i=Array.isArray(n)?[]:{},t;if(n&&typeof n=="object")for(t in n)n.hasOwnProperty(t)&&(i[t]=n&&typeof n[t]=="object"?this.deepClone(n[t]):n[t]);return i},clearOriginCols:function(n){n?delete u[n]:u={}}};n("soulTable",c)});